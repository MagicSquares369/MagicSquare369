
<!DOCTYPE html>

<html lang="ru">
<head>
<link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@500&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@500&amp;display=swap" rel="stylesheet"/>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>–ú–∞–≥–∏—á–µ—Å–∫–∏–µ –∫–≤–∞–¥—Ä–∞—Ç—ã </title>
<link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;700&amp;display=swap" rel="stylesheet"/>
<style>
.top-bar {
  position: fixed;
  top: 20px;
  right: 20px;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  z-index: 1000;
  background: none;
  box-shadow: none;
}
.top-bar .custom-button {
  font-family: inherit;
  font-weight: bold;
  background-color: #c49b7e;
  color: white;
  padding: 10px 16px;
  border-radius: 12px;
  border: none;
  cursor: pointer;
  text-decoration: none;
  display: inline-block;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}
.top-bar .custom-button:hover {
  background-color: #b48768;
}

  .dimmed {
    opacity: 0.2 !important;
    transition: opacity 0.3s ease;
  }

  .highlighted {
    opacity: 1 !important;
    filter: drop-shadow(0 0 3px currentColor);
  }

    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: 'Raleway', sans-serif;
      background: linear-gradient(135deg, #fdfcfb, #e2d1c3);
      color: #333;
      text-align: center;
      overflow-x: hidden;
    }
    body {
      padding: 2rem;
    }
    select, button {
      font-size: 1.2rem;
      padding: 0.5rem;
      margin: 0.5rem;
      font-family: 'Raleway', sans-serif;
    }
    .container {
      position: relative;
      display: inline-block;
      margin: 0 auto;
    }
    table {
      width: 100%;
      max-width: 480px;
      min-width: 300px;
      border-collapse: collapse;
      position: relative;
      z-index: 1;
      margin: 0 auto;
    }
    td {
      width: 160px;
      height: 160px;
      font-size: 2.5rem;
      border: 1px solid #aaa;
      text-align: center;
      vertical-align: middle;
      background: white;
      position: relative;
      animation: fadeInScale 0.5s ease forwards;
    }
    .digit-span {
      display: inline-block;
      width: 1ch;
    }
    svg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 2;
      pointer-events: none;
    }
    .center-dot {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: black;
      opacity: 0.3;
      z-index: 3;
      pointer-events: none;
    }
    line.animated {
      stroke-dasharray: 1000;
      stroke-dashoffset: 1000;
      animation: draw 1s ease forwards;
    }
    @keyframes draw {
      to {
        stroke-dashoffset: 0;
      }
    }
    @keyframes fadeInScale {
      from {
        opacity: 0;
        transform: scale(0.3);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }
  
td { font-family: 'Fira Mono', monospace !important; }
body {
  background: linear-gradient(135deg, #fdfcfb, #e2d1c3);
  font-family: 'Poppins', sans-serif;
  color: #333;
}

td {
  border-radius: 10px;
  background: linear-gradient(to bottom, #ffffff, #f0f0f0);
  box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.1);
  animation: pop 0.4s ease-in-out;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

td:hover {
  box-shadow: 0 0 10px #00c3ff;
  transform: scale(1.05);
}

@keyframes pop {
  from { transform: scale(0.7); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}

table {
  border: 2px solid #444;
  border-radius: 16px;
  padding: 1rem;
  background: #fff;
  margin: 1rem auto;
}

line.animated {
  stroke-dasharray: 1000;
  stroke-dashoffset: 1000;
  animation: draw 1.2s ease forwards;
}

@keyframes draw {
  to { stroke-dashoffset: 0; }
}

#analysis-output table td {
  width: 120px !important;
  height: 120px !important;
  font-size: 1.6rem !important;
}

#analysis-output table td {
  width: 96px !important;
  height: 96px !important;
  font-size: 1.4rem !important;
}

body {
  background-image: url('https://www.transparenttextures.com/patterns/cubes.png');
  background-size: 400px 400px;
  background-repeat: repeat;
  background-attachment: fixed;
  background-blend-mode: overlay;
}

table#square {
  border: 4px solid gold;
  border-radius: 16px;
  padding: 1rem;
  background: #fff;
  margin: 1rem auto;
  box-shadow: 0 0 15px rgba(255, 215, 0, 0.7);
}

button {
  background: linear-gradient(to right, #d4bfa3, #caa98c);
  border: none;
  border-radius: 8px;
  color: white;
  font-weight: bold;
  padding: 0.6rem 1.2rem;
  cursor: pointer;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  transition: transform 0.2s, box-shadow 0.2s;
}
button:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 10px rgba(0,0,0,0.15);
}


.description-box {
  background: rgba(255, 255, 255, 0.85);
  padding: 1.5rem;
  margin: 2rem auto;
  border-radius: 16px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  font-size: 1.1rem;
  line-height: 1.6;
  max-width: 800px;
  text-align: left;
}


td {
  width: 160px;
  height: 160px;
  font-size: 2.5rem;
  border: 1px solid #aaa;
  text-align: center;
  vertical-align: middle;
  background: linear-gradient(to bottom, #ffffff, #f0f0f0);
  border-radius: 10px;
  box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.1);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  animation: pop 0.4s ease-in-out;
  font-family: 'Fira Mono', monospace !important;
}
td:hover {
  box-shadow: 0 0 10px #00c3ff;
  transform: scale(1.05);
}
@keyframes pop {
  from { transform: scale(0.7); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}



select {
  background: #fff;
  border: 2px solid #caa98c;
  border-radius: 8px;
  padding: 0.5rem 1rem;
  padding-right: 2rem;
  font-size: 1rem;
  color: #333;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  transition: border-color 0.3s, box-shadow 0.3s;
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  background-image: url('data:image/svg+xml;utf8,<svg fill="%23666" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
  background-repeat: no-repeat;
  background-position: right 0.8rem center;
  background-size: 1rem;
  font-family: 'Source Code Pro', monospace;
}
select:focus {
  outline: none;
  border-color: #d4bfa3;
  box-shadow: 0 0 0 3px rgba(202, 169, 140, 0.3);
}
.key-select-group {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 0.5rem;
  margin-bottom: 1rem;
}
label {
  font-weight: bold;
  font-size: 1.1rem;
  margin: auto 0.5rem;
}



.select-pair {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}
.combo-text {
  font-size: 0.9rem;
  color: #555;
  margin: 0 4px;
}



.digit-span {
  font-family: 'Poppins', sans-serif;
  font-weight: 600;
  font-size: 2.2rem;
}



.digit-span {
  font-family: 'Source Code Pro', monospace;
  font-weight: 500;
  font-size: 2.2rem;
}
select {
  background: #fff;
  border: 2px solid #caa98c;
  border-radius: 8px;
  padding: 0.5rem 1rem;
  padding-right: 2rem;
  font-size: 1rem;
  color: #333;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  transition: border-color 0.3s, box-shadow 0.3s;
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  background-image: url('data:image/svg+xml;utf8,<svg fill="%23666" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
  background-repeat: no-repeat;
  background-position: right 0.8rem center;
  background-size: 1rem;
  font-family: 'Source Code Pro', monospace;
}



.key-info-hint {
  background: rgba(255, 255, 255, 0.7);
  border-left: 4px solid #caa98c;
  padding: 1rem;
  margin: 1rem auto 2rem auto;
  max-width: 600px;
  border-radius: 10px;
  font-size: 1rem;
  line-height: 1.5;
  text-align: center;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}



.subheading {
  font-family: 'Merriweather', serif;
  font-size: 1.6rem;
  font-weight: 400;
  margin-top: -1rem;
  margin-bottom: 2rem;
  color: #555;
  background: linear-gradient(to right, #b49c7f, #d2b89a);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  text-shadow: 0 1px 1px rgba(0, 0, 0, 0.05);
}


.resource-button {
  display: inline-block;
  padding: 0.5rem 1rem;
  margin-top: 1rem;
  background: linear-gradient(to right, #caa98c, #b5956b);
  color: white;
  font-weight: bold;
  border-radius: 10px;
  text-decoration: none;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  transition: all 0.2s ease;
}
.resource-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 14px rgba(0,0,0,0.15);
}

.top-right-button {
  position: absolute;
  top: 1.2rem;
  right: 2rem;
  z-index: 1000;
}


.tooltip {
  position: absolute;
  background: rgba(0, 0, 0, 0.8);
  color: #fff;
  padding: 0.5rem 1rem;
  border-radius: 8px;
  font-size: 0.9rem;
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.2s ease, transform 0.2s ease;
  transform: translateY(-10px);
  z-index: 9999;
}
.tooltip.visible {
  opacity: 1;
  transform: translateY(0);
}


.styled-select {
  background: #fff;
  border: 2px solid #caa98c;
  border-radius: 8px;
  padding: 0.5rem 1rem;
  padding-right: 2rem;
  font-size: 1rem;
  color: #333;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  background-image: url('data:image/svg+xml;utf8,<svg fill="%23666" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
  background-repeat: no-repeat;
  background-position: right 0.8rem center;
  background-size: 1rem;
  font-family: 'Source Code Pro', monospace;
}







select, #combo1, #combo2, #select1, #select2 {
  background: #fff;
  border: 2px solid #caa98c;
  border-radius: 8px;
  padding: 0.6rem 1.2rem;
  padding-right: 3rem;
  font-size: 1.1rem;
  min-width: 80px;
  color: #333;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  background-image: url('data:image/svg+xml;utf8,<svg fill="%23666" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
  background-repeat: no-repeat;
  background-position: right 0.8rem center;
  background-size: 1rem;
  font-family: 'Source Code Pro', monospace;
}


.step-card {
  border: 2px solid #caa98c !important;
  border-radius: 16px !important;
  padding: 1.5rem !important;
  background-color: white !important;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15) !important;
}


.lang-ru, .lang-uk, .lang-en, .lang-de {
  display: none;
}
.lang-visible {
  display: block !important;
}
</style>
<style>
.step-card {
  display: none;
  transition: opacity 0.4s ease;
}
.step-card.active {
  display: block;
}

.styled-select {
  background: #fff;
  border: 2px solid #caa98c;
  border-radius: 8px;
  padding: 0.5rem 1rem;
  padding-right: 2rem;
  font-size: 1rem;
  color: #333;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  background-image: url('data:image/svg+xml;utf8,<svg fill="%23666" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
  background-repeat: no-repeat;
  background-position: right 0.8rem center;
  background-size: 1rem;
  font-family: 'Source Code Pro', monospace;
}







select, #combo1, #combo2, #select1, #select2 {
  background: #fff;
  border: 2px solid #caa98c;
  border-radius: 8px;
  padding: 0.6rem 1.2rem;
  padding-right: 3rem;
  font-size: 1.1rem;
  min-width: 80px;
  color: #333;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  background-image: url('data:image/svg+xml;utf8,<svg fill="%23666" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
  background-repeat: no-repeat;
  background-position: right 0.8rem center;
  background-size: 1rem;
  font-family: 'Source Code Pro', monospace;
}


.lang-ru, .lang-uk, .lang-en, .lang-de {
  display: none;
}
.lang-visible {
  display: block !important;
}
</style>
<link href="https://fonts.googleapis.com/css2?family=Fira+Mono&amp;display=swap" rel="stylesheet"/><link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600&amp;display=swap" rel="stylesheet"/><style>
select[title] {
    cursor: help;
}
  h1 {
  font-family: 'Merriweather', serif;
  font-size: 3rem;
  margin-top: 2rem;
  padding: 1rem 2.5rem;
  background: #f7f3ed;
  border-radius: 3rem;
  border: 2px solid #b5956b;
  display: inline-block;
  box-shadow: 0 6px 14px rgba(0,0,0,0.08);
  background-clip: padding-box;
  background-origin: padding-box;
  background-image: linear-gradient(to right, #d4bfa3, #caa98c);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.07);
}

.top-right-button {
  position: absolute;
  top: 1.2rem;
  right: 2rem;
  z-index: 1000;
}


.styled-select {
  background: #fff;
  border: 2px solid #caa98c;
  border-radius: 8px;
  padding: 0.5rem 1rem;
  padding-right: 2rem;
  font-size: 1rem;
  color: #333;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  background-image: url('data:image/svg+xml;utf8,<svg fill="%23666" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
  background-repeat: no-repeat;
  background-position: right 0.8rem center;
  background-size: 1rem;
  font-family: 'Source Code Pro', monospace;
}







select, #combo1, #combo2, #select1, #select2 {
  background: #fff;
  border: 2px solid #caa98c;
  border-radius: 8px;
  padding: 0.6rem 1.2rem;
  padding-right: 3rem;
  font-size: 1.1rem;
  min-width: 80px;
  color: #333;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  background-image: url('data:image/svg+xml;utf8,<svg fill="%23666" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
  background-repeat: no-repeat;
  background-position: right 0.8rem center;
  background-size: 1rem;
  font-family: 'Source Code Pro', monospace;
}


.lang-ru, .lang-uk, .lang-en, .lang-de {
  display: none;
}
.lang-visible {
  display: block !important;
}
</style><style>
/* –£–º–µ–Ω—å—à–∞–µ–º —Ä–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü –≤ —à–∞–≥–∞—Ö */
#intro-step-output table {
  font-size: 1.2rem !important;
  border: 1px solid #bbb !important;
}

#intro-step-output table td {
  font-size: 1rem !important;
  padding: 0.4rem !important;
  width: 50px !important;
  height: 50px !important;
}

#intro-step-output div[id^="step"] {
  max-width: 500px !important;
  margin: 0.6rem auto !important;
  padding: 0.6rem !important;
  font-size: 0.95rem !important;
}

#intro-step-output h3 {
  font-size: 1.1rem !important;
}

#intro-step-output p, #intro-step-output ul, #intro-step-output li {
  font-size: 0.9rem !important;
}

.styled-select {
  background: #fff;
  border: 2px solid #caa98c;
  border-radius: 8px;
  padding: 0.5rem 1rem;
  padding-right: 2rem;
  font-size: 1rem;
  color: #333;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  background-image: url('data:image/svg+xml;utf8,<svg fill="%23666" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
  background-repeat: no-repeat;
  background-position: right 0.8rem center;
  background-size: 1rem;
  font-family: 'Source Code Pro', monospace;
}







select, #combo1, #combo2, #select1, #select2 {
  background: #fff;
  border: 2px solid #caa98c;
  border-radius: 8px;
  padding: 0.6rem 1.2rem;
  padding-right: 3rem;
  font-size: 1.1rem;
  min-width: 80px;
  color: #333;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  background-image: url('data:image/svg+xml;utf8,<svg fill="%23666" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
  background-repeat: no-repeat;
  background-position: right 0.8rem center;
  background-size: 1rem;
  font-family: 'Source Code Pro', monospace;
}


.lang-ru, .lang-uk, .lang-en, .lang-de {
  display: none;
}
.lang-visible {
  display: block !important;
}
</style><style>
#intro-step-output div[id^="step"] {
  background: #ffffff !important;
}

.styled-select {
  background: #fff;
  border: 2px solid #caa98c;
  border-radius: 8px;
  padding: 0.5rem 1rem;
  padding-right: 2rem;
  font-size: 1rem;
  color: #333;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  background-image: url('data:image/svg+xml;utf8,<svg fill="%23666" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
  background-repeat: no-repeat;
  background-position: right 0.8rem center;
  background-size: 1rem;
  font-family: 'Source Code Pro', monospace;
}







select, #combo1, #combo2, #select1, #select2 {
  background: #fff;
  border: 2px solid #caa98c;
  border-radius: 8px;
  padding: 0.6rem 1.2rem;
  padding-right: 3rem;
  font-size: 1.1rem;
  min-width: 80px;
  color: #333;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  background-image: url('data:image/svg+xml;utf8,<svg fill="%23666" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
  background-repeat: no-repeat;
  background-position: right 0.8rem center;
  background-size: 1rem;
  font-family: 'Source Code Pro', monospace;
}


.lang-ru, .lang-uk, .lang-en, .lang-de {
  display: none;
}
.lang-visible {
  display: block !important;
}
</style>
<style>
  #intro-step-output.step-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    justify-content: center;
    align-items: flex-start;
    max-width: 1100px;
    margin-left: auto;
    margin-right: auto;
  }

  #intro-step-output.step-grid > div[id^="step"] {
    flex: 1 1 calc(33.33% - 1rem);
    min-width: 280px;
    max-width: 340px;
  }

  @media (max-width: 900px) {
    #intro-step-output.step-grid > div[id^="step"] {
      flex: 1 1 calc(50% - 1rem);
    }
  }

  @media (max-width: 600px) {
    #intro-step-output.step-grid > div[id^="step"] {
      flex: 1 1 100%;
    }
  }

.styled-select {
  background: #fff;
  border: 2px solid #caa98c;
  border-radius: 8px;
  padding: 0.5rem 1rem;
  padding-right: 2rem;
  font-size: 1rem;
  color: #333;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  background-image: url('data:image/svg+xml;utf8,<svg fill="%23666" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
  background-repeat: no-repeat;
  background-position: right 0.8rem center;
  background-size: 1rem;
  font-family: 'Source Code Pro', monospace;
}







select, #combo1, #combo2, #select1, #select2 {
  background: #fff;
  border: 2px solid #caa98c;
  border-radius: 8px;
  padding: 0.6rem 1.2rem;
  padding-right: 3rem;
  font-size: 1.1rem;
  min-width: 80px;
  color: #333;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  background-image: url('data:image/svg+xml;utf8,<svg fill="%23666" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
  background-repeat: no-repeat;
  background-position: right 0.8rem center;
  background-size: 1rem;
  font-family: 'Source Code Pro', monospace;
}


.lang-ru, .lang-uk, .lang-en, .lang-de {
  display: none;
}
.lang-visible {
  display: block !important;
}
</style>
<style>
.lang-selector {
  position: fixed;
  top: 20px;
  left: 20px;
  z-index: 1001;
}
.lang-selector select {
  padding: 0.4rem 1rem;
  border-radius: 8px;
  border: 2px solid #caa98c;
  font-size: 1rem;
  font-family: 'Source Code Pro', monospace;
  background: #fff;
  cursor: pointer;
}

.lang-ru, .lang-uk, .lang-en, .lang-de {
  display: none;
}
.lang-visible {
  display: block !important;
}
</style></head>
<body>
<div class="lang-selector">
<select id="language-select">
<option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
<option value="uk">üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
<option value="en">üá¨üáß English</option>
<option value="de">üá©üá™ Deutsch</option>
</select>
</div>
<div class="top-bar">
<a class="custom-button" data-i18n="resources" data-tooltip="–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏" data-tooltip-key="resources_tip" href="resources.html">üîó –†–µ—Å—É—Ä—Å—ã</a>
<button class="custom-button" data-i18n="training" data-tooltip="–û–±—É—á–µ–Ω–∏–µ –≤ –ø–æ—à–∞–≥–æ–≤–æ–º —Ä–µ–∂–∏–º–µ" data-tooltip-key="training_tip" id="start-intro">üß† –û–±—É—á–∞—é—â–∏–π —Ä–µ–∂–∏–º</button>
<button class="custom-button" data-i18n="analyze" data-tooltip="–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –∫–≤–∞–¥—Ä–∞—Ç–∞ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ –º–∞–≥–∏—á–µ—Å–∫–∏–π, –µ—Å–ª–∏ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ" data-tooltip-key="analyze_tip" id="analyze-auto-btn">üìä –ê–Ω–∞–ª–∏–∑</button>
</div>
<h1 data-i18n="heading">–ú–∞–≥–∏—á–µ—Å–∫–∏–µ –∫–≤–∞–¥—Ä–∞—Ç—ã </h1>
<h2 class="subheading" data-i18n="subheading">–ø–æ –º–µ—Ç–æ–¥–∏–∫–µ –ê—Å–ª–∞–Ω–∞ –£–∞—Ä–∑–∏–∞—Ç—ã</h2>


<p class="key-info-hint" data-i18n="how_text" data-html="true"></p>



<div class="key-select-group">
<label for="key1" data-i18n="label_key1">–ö–ª—é—á 1:</label>
<div class="select-pair">
<select data-tooltip="–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–≤—ã–π –∫–ª—é—á ‚Äî —Ç—Ä–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ü–∏—Ñ—Ä—ã" id="key1"></select>
<span class="combo-text" data-i18n="in_combination">–≤ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏</span>
<select data-tooltip="–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Ä—è–¥–æ–∫ —Ü–∏—Ñ—Ä –¥–ª—è –∫–ª—é—á–∞ 1" id="order1"></select>
</div>
</div>
<div class="key-select-group">
<label for="key2" data-i18n="label_key2">–ö–ª—é—á 2:</label>
<div class="select-pair">
<select data-tooltip="–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ç–æ—Ä–æ–π –∫–ª—é—á ‚Äî —Ç—Ä–∏ –¥—Ä—É–≥–∏–µ —Ü–∏—Ñ—Ä—ã" id="key2"></select>
<span class="combo-text" data-i18n="in_combination">–≤ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏</span>
<select data-tooltip="–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Ä—è–¥–æ–∫ —Ü–∏—Ñ—Ä –¥–ª—è –∫–ª—é—á–∞ 2" id="order2"></select>
</div>
</div>
<button data-i18n="build" data-tooltip="–°–æ–∑–¥–∞—Ç—å –º–∞–≥–∏—á–µ—Å–∫–∏–π –∫–≤–∞–¥—Ä–∞—Ç" onclick="buildSquare()">–ü–æ—Å—Ç—Ä–æ–∏—Ç—å</button>
<div class="outer-wrapper" style="display: flex; justify-content: center;"><div class="container">
<svg id="lines" xmlns="http://www.w3.org/2000/svg"></svg>
<table id="square"></table></div></div>
<div>
</div>
<div style="margin-top: 2rem;">
</div>
<div id="intro-anchor" style="height: 1px;"></div>
<div class="step-grid" id="intro-step-output" style="margin-top: 2rem;"></div>
<div id="analyze-anchor" style="height: 1px;"></div>
<div class="description-box" id="analysis-results">
  <div class="lang-ru lang-visible">
    <h2>–ö–∞–∫ —Å—Ç—Ä–æ–∏—Ç—Å—è –∫–≤–∞–¥—Ä–∞—Ç?</h2>
    <p>–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–≤–∞–¥—Ä–∞—Ç–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ –º–µ—Ç–æ–¥–∏–∫–µ –ê—Å–ª–∞–Ω–∞ –£–∞—Ä–∑–∏–∞—Ç—ã. –ü—Ä–æ–π–¥–∏—Ç–µ –æ–±—É—á–∞—é—â–∏–π —Ä–µ–∂–∏–º –¥–ª—è –ª—É—á—à–µ–≥–æ –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏—è.</p>
    <p>–ò—Ç–æ–≥ ‚Äî –º–∞–≥–∏—á–µ—Å–∫–∏–π –∫–≤–∞–¥—Ä–∞—Ç, –≥–¥–µ —Å—É–º–º–∞ —Å—Ç—Ä–æ–∫, —Å—Ç–æ–ª–±—Ü–æ–≤ –∏ –¥–∏–∞–≥–æ–Ω–∞–ª–µ–π –æ–¥–∏–Ω–∞–∫–æ–≤–∞. –û–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Ü–∏—Ñ—Ä—ã —Å–æ–µ–¥–∏–Ω—è—é—Ç—Å—è —Ü–≤–µ—Ç–Ω—ã–º–∏ –ª–∏–Ω–∏—è–º–∏, —Ñ–æ—Ä–º–∏—Ä—É—è –≤–æ—Å—å–º–∏–ª—É—á–µ–≤—É—é –∑–≤–µ–∑–¥—É.</p>
    <p>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –∏–Ω–æ–≥–¥–∞ –∫–≤–∞–¥—Ä–∞—Ç –±—É–¥–µ—Ç –±–∞–∑–æ–≤—ã–º, —Ç.–µ. —Å—É–º–º—ã –µ–≥–æ —Å—Ç–æ–ª–±—Ü–æ–≤ –∏ —Ä—è–¥–æ–≤ –±—É–¥—É—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã, –∞ –¥–∏–∞–≥–æ–Ω–∞–ª–µ–π ‚Äî –Ω–µ—Ç. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ "–ê–Ω–∞–ª–∏–∑" —Å–∞–π—Ç –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç –µ–≥–æ –≤ –º–∞–≥–∏—á–µ—Å–∫–∏–π. –í —Ä–µ–¥–∫–∏—Ö —Å–ª—É—á–∞—è—Ö –∫–≤–∞–¥—Ä–∞—Ç –Ω–µ –∏–º–µ–µ—Ç —Å–≤–æ–π—Å—Ç–≤–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞—Ç—å—Å—è –≤ –º–∞–≥–∏—á–µ—Å–∫–∏–π.</p>
  </div>

  <div class="lang-en">
    <h2>How is the square built?</h2>
    <p>The square is built using the method of Aslan Uarziaty. Go through the training mode to better understand it.</p>
    <p>The result is a magic square where the sums of rows, columns, and diagonals are equal. Identical digits are connected with colored lines, forming an eight-pointed star.</p>
    <p>Note: sometimes the square will be a base square, meaning its rows and columns have equal sums, but not the diagonals. Pressing the "Analyze" button will transform it into a magic square. In rare cases, the square cannot be transformed into a magic one.</p>
  </div>

  <div class="lang-uk">
    <h2>–Ø–∫ –±—É–¥—É—î—Ç—å—Å—è –∫–≤–∞–¥—Ä–∞—Ç?</h2>
    <p>–ü–æ–±—É–¥–æ–≤–∞ –∫–≤–∞–¥—Ä–∞—Ç–∞ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –∑–∞ –º–µ—Ç–æ–¥–∏–∫–æ—é –ê—Å–ª–∞–Ω–∞ –£–∞—Ä–∑—ñ–∞—Ç–∏. –ü—Ä–æ–π–¥—ñ—Ç—å –Ω–∞–≤—á–∞–ª—å–Ω–∏–π —Ä–µ–∂–∏–º –¥–ª—è –∫—Ä–∞—â–æ–≥–æ –æ–∑–Ω–∞–π–æ–º–ª–µ–Ω–Ω—è.</p>
    <p>–£ –ø—ñ–¥—Å—É–º–∫—É ‚Äî –º–∞–≥—ñ—á–Ω–∏–π –∫–≤–∞–¥—Ä–∞—Ç, —É —è–∫–æ–º—É —Å—É–º–∏ —Ä—è–¥–∫—ñ–≤, —Å—Ç–æ–≤–ø—Ü—ñ–≤ —ñ –¥—ñ–∞–≥–æ–Ω–∞–ª–µ–π –æ–¥–Ω–∞–∫–æ–≤—ñ. –û–¥–Ω–∞–∫–æ–≤—ñ —Ü–∏—Ñ—Ä–∏ –∑'—î–¥–Ω—É—é—Ç—å—Å—è –∫–æ–ª—å–æ—Ä–æ–≤–∏–º–∏ –ª—ñ–Ω—ñ—è–º–∏, —É—Ç–≤–æ—Ä—é—é—á–∏ –≤–æ—Å—å–º–∏–ø—Ä–æ–º–µ–Ω–µ–≤—É –∑—ñ—Ä–∫—É.</p>
    <p>–ü—Ä–∏–º—ñ—Ç–∫–∞: —ñ–Ω–æ–¥—ñ –∫–≤–∞–¥—Ä–∞—Ç –±—É–¥–µ –±–∞–∑–æ–≤–∏–º, —Ç–æ–±—Ç–æ —Å—É–º–∏ –π–æ–≥–æ —Ä—è–¥–∫—ñ–≤ —ñ —Å—Ç–æ–≤–ø—Ü—ñ–≤ –æ–¥–Ω–∞–∫–æ–≤—ñ, –∞–ª–µ –¥—ñ–∞–≥–æ–Ω–∞–ª–µ–π ‚Äî –Ω—ñ. –ù–∞—Ç–∏—Å–Ω—É–≤—à–∏ –∫–Ω–æ–ø–∫—É "–ê–Ω–∞–ª—ñ–∑", —Å–∞–π—Ç –ø–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç—å –π–æ–≥–æ –Ω–∞ –º–∞–≥—ñ—á–Ω–∏–π. –£ —Ä—ñ–¥–∫—ñ—Å–Ω–∏—Ö –≤–∏–ø–∞–¥–∫–∞—Ö –∫–≤–∞–¥—Ä–∞—Ç –Ω–µ –º–æ–∂–Ω–∞ –ø–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–∞ –º–∞–≥—ñ—á–Ω–∏–π.</p>
  </div>

  <div class="lang-de">
    <h2>Wie wird das Quadrat gebaut?</h2>
    <p>Das Quadrat wird nach der Methode von Aslan Uarziaty erstellt. Verwenden Sie den Lernmodus f√ºr ein besseres Verst√§ndnis.</p>
    <p>Das Ergebnis ist ein magisches Quadrat, bei dem die Summen der Zeilen, Spalten und Diagonalen gleich sind. Gleiche Ziffern werden mit farbigen Linien verbunden, wodurch ein achtstrahliger Stern entsteht.</p>
    <p>Hinweis: Manchmal ist das Quadrat ein Basisk√§stchen, d.‚ÄØh. Zeilen- und Spaltensummen sind gleich, aber nicht die Diagonalen. Mit einem Klick auf "Analyse" wird es in ein magisches Quadrat umgewandelt. In seltenen F√§llen kann das Quadrat nicht in ein magisches umgewandelt werden.</p>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
);
          document.querySelectorAll("#lines line").forEach(line => {
            if (line.getAttribute("data-digit") === digit) {
              line.classList.add("highlighted");
              line.classList.remove("dimmed");
            } else {
              line.classList.add("dimmed");
              line.classList.remove("highlighted");
            }
          });
        });

        span.addEventListener("mouseleave", () => {
          document.querySelectorAll(".digit-span, #lines line").forEach(el => {
            el.classList.remove("dimmed", "highlighted");
          });
        });
        cell.appendChild(span);
      });
      cell.setAttribute("data-val", square[i][j]);
      const dot = document.createElement('div');
      dot.className = 'center-dot';
      cell.appendChild(dot);
      row.appendChild(cell);
    }
    table.appendChild(row);
  }
}

function drawLines(square) {
  const svg = document.getElementById('lines');
  const table = document.getElementById('square');
  const svgRect = svg.getBoundingClientRect();
  svg.innerHTML = '';

  const digitMap = {};
  const palette = {
    "1": "red", "2": "blue", "3": "green", "4": "orange", "5": "purple",
    "6": "teal", "7": "brown", "8": "magenta", "9": "gold"
  };

  const cells = [...table.querySelectorAll('td')];
  cells.forEach(td => {
    const val = td.getAttribute("data-val");
    const digits = val.toString().padStart(2, '0').split('');
    const box = td.getBoundingClientRect();
    const cx = box.left + box.width / 2 - svgRect.left;
    const cy = box.top + box.height / 2 - svgRect.top;

    digits.forEach(d => {
      if (!digitMap[d]) digitMap[d] = [];
      digitMap[d].push({ x: cx, y: cy });
    });
  });

  Object.keys(digitMap).forEach(d => {
    const spans = document.querySelectorAll(`.digit-span[data-digit='${d}']`);
    spans.forEach(span => {
      span.style.color = palette[d] || "gray";
    });
  });

  let digitOrder = Object.keys(digitMap).sort();
  let globalDelay = 0;

  digitOrder.forEach(digit => {
    const points = digitMap[digit];
    const color = palette[digit] || "gray";

    for (let i = 0; i < points.length; i++) {
      for (let j = i + 1; j < points.length; j++) {
        const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
        line.setAttribute("x1", points[i].x);
        line.setAttribute("y1", points[i].y);
        line.setAttribute("x2", points[j].x);
        line.setAttribute("y2", points[j].y);
        line.setAttribute("stroke", color);
        line.setAttribute("stroke-width", "3");
        line.setAttribute("data-digit", digit);
        line.classList.add("animated");
        setTimeout(() => svg.appendChild(line), globalDelay);
        globalDelay += 400;
      }
    }
  });
}


  updateOrderSelect('order1', "147"); setTimeout(disableInvalidKeys, 0);
  updateOrderSelect('order2', "369");
  key1.value = "147";
  key2.value = "369";
  key1.addEventListener('change', e => { updateOrderSelect('order1', e.target.value); setTimeout(disableInvalidKeys, 0); });
  key2.addEventListener('change', e => updateOrderSelect('order2', e.target.value));
});
</script>
<script>
function autoAnalyzeSquare() {
  const table = document.querySelector("table");
  if (!table) return alert("–ö–≤–∞–¥—Ä–∞—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω.");

  const rows = table.querySelectorAll("tr");
  if (rows.length !== 3) return (function(){
  let lang = localStorage.getItem('lang');
if (!lang) {
  lang = 'ru';
  localStorage.setItem('lang', lang);
}
  console.log("DEBUG: —Ç–µ–∫—É—â–∏–π —è–∑—ã–∫ lang =", lang);
  const messages = {
    ru: "–û—à–∏–±–∫–∞: —Å–Ω–∞—á–∞–ª–∞ –ø–æ—Å—Ç—Ä–æ–π—Ç–µ –∫–≤–∞–¥—Ä–∞—Ç.",
    uk: "–ü–æ–º–∏–ª–∫–∞: —Å–ø–µ—Ä—à—É –ø–æ–±—É–¥—É–π—Ç–µ –∫–≤–∞–¥—Ä–∞—Ç.",
    en: "Error: please build the square first.",
    de: "Fehler: Bitte zuerst das Quadrat erstellen."
  };
  alert(messages[lang]);
})();

  const matrix = [];
  for (let row of rows) {
    const cells = row.querySelectorAll("td");
    if (cells.length !== 3) return alert("–û—à–∏–±–∫–∞: —Å—Ç—Ä–æ–∫–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å 3 —è—á–µ–π–∫–∏.");
    const nums = [];
    for (let cell of cells) {
      const val = parseInt(cell.getAttribute("data-val"));
      if (isNaN(val)) return alert("–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å —á–∏—Å–ª–æ.");
      nums.push(val);
    }
    matrix.push(nums);
  }

  function renderSquare(matrix, title) {
    const wrapper = document.createElement("div");
    wrapper.style.margin = "2rem auto";
    wrapper.style.padding = "1rem";
    wrapper.style.border = "1px solid #ccc";
    wrapper.style.borderRadius = "8px";
    wrapper.style.background = "#fafafa";
    wrapper.style.marginRight = "1rem";
    wrapper.style.display = "inline-block";
    const resultTable = document.createElement("table");
    resultTable.style.borderCollapse = "collapse";
    resultTable.style.margin = "0 auto";

    // –ê–Ω—Ç–∏–¥–∏–∞–≥–æ–Ω–∞–ª—å
    const rightDiagSum = matrix[0][2] + matrix[1][1] + matrix[2][0];
    const top = document.createElement("tr");
    top.innerHTML = "<td></td><td></td><td></td><td class='sum-diag'>‚Üô " + rightDiagSum + "</td>";
    resultTable.appendChild(top);

    for (let i = 0; i < 3; i++) {
      const tr = document.createElement("tr");
      for (let j = 0; j < 3; j++) {
        const td = document.createElement("td");
        td.textContent = matrix[i][j];
        td.setAttribute("data-val", matrix[i][j]);
        td.style.border = "1px solid #555";
        td.style.width = "45px";
        td.style.height = "45px";
        td.style.textAlign = "center";
        td.style.fontSize = "1.5rem";
        td.style.fontFamily = "'Fira Mono', monospace";
        td.style.background = "#fff";
        tr.appendChild(td);
      }
      const rowSum = matrix[i][0] + matrix[i][1] + matrix[i][2];
      const sumTd = document.createElement("td");
      sumTd.textContent = "‚á® " + rowSum;
      sumTd.className = "sum-row";
      tr.appendChild(sumTd);
      resultTable.appendChild(tr);
    }

    const colSumRow = document.createElement("tr");
    for (let j = 0; j < 3; j++) {
      const colSum = matrix[0][j] + matrix[1][j] + matrix[2][j];
      const td = document.createElement("td");
      td.textContent = "‚á© " + colSum;
      td.className = "sum-col";
      colSumRow.appendChild(td);
    }
    const leftDiagSum = matrix[0][0] + matrix[1][1] + matrix[2][2];
    const diagTd = document.createElement("td");
    diagTd.textContent = "‚Üò " + leftDiagSum;
    diagTd.className = "sum-diag";
    colSumRow.appendChild(diagTd);
    resultTable.appendChild(colSumRow);

    const label = document.createElement("div");
    
    label.innerHTML = `
      <div class="lang-ru">` + (title === "–ò—Å—Ö–æ–¥–Ω—ã–π –∫–≤–∞–¥—Ä–∞—Ç" ? "–ò—Å—Ö–æ–¥–Ω—ã–π –∫–≤–∞–¥—Ä–∞—Ç" : "–ú–∞–≥–∏—á–µ—Å–∫–∏–π –∫–≤–∞–¥—Ä–∞—Ç") + `</div>
      <div class="lang-uk">` + (title === "–ò—Å—Ö–æ–¥–Ω—ã–π –∫–≤–∞–¥—Ä–∞—Ç" ? "–ü–æ—á–∞—Ç–∫–æ–≤–∏–π –∫–≤–∞–¥—Ä–∞—Ç" : "–ú–∞–≥—ñ—á–Ω–∏–π –∫–≤–∞–¥—Ä–∞—Ç") + `</div>
      <div class="lang-en">` + (title === "–ò—Å—Ö–æ–¥–Ω—ã–π –∫–≤–∞–¥—Ä–∞—Ç" ? "Original Square" : "Magic Square") + `</div>
      <div class="lang-de">` + (title === "–ò—Å—Ö–æ–¥–Ω—ã–π –∫–≤–∞–¥—Ä–∞—Ç" ? "Ausgangsquadrat" : "Magisches Quadrat") + `</div>
    `;
    label.classList.add("square-label");

    label.style.fontWeight = "bold";
    label.style.marginBottom = "0.5rem";
    label.style.textAlign = "center";

    wrapper.appendChild(label);
    wrapper.appendChild(resultTable);
    return wrapper;
  }

  function isMagic(matrix) {
    const sums = [
      ...matrix.map(row => row.reduce((a,b) => a+b)),
      ...[0,1,2].map(i => matrix[0][i]+matrix[1][i]+matrix[2][i]),
      matrix[0][0] + matrix[1][1] + matrix[2][2],
      matrix[0][2] + matrix[1][1] + matrix[2][0]
    ];
    return sums.every(s => s === sums[0]);
  }

  function permutations(arr) {
    if (arr.length <= 1) return [arr];
    const result = [];
    for (let i = 0; i < arr.length; i++) {
      const rest = [...arr.slice(0, i), ...arr.slice(i+1)];
      const inner = permutations(rest);
      for (let perm of inner) result.push([arr[i], ...perm]);
    }
    return result;
  }

  function transpose(matrix) {
    return matrix[0].map((_, i) => matrix.map(row => row[i]));
  }

  const output = document.getElementById("analysis-output") || document.createElement("div");
  output.id = "analysis-output";
  output.innerHTML = "";
  output.style.marginTop = "2rem";

  const base = renderSquare(matrix, "–ò—Å—Ö–æ–¥–Ω—ã–π –∫–≤–∞–¥—Ä–∞—Ç");
  output.appendChild(base);

  
  const refBox = document.getElementById("analysis-results");
if (refBox && refBox.parentNode) {
  refBox.parentNode.insertBefore(output, refBox);
} else {
  
const anchor = document.createElement("div");
anchor.id = "analyze-anchor";
output.parentNode.insertBefore(anchor, output);
document.body.appendChild(output); // fallback
if (output) {
  const anchor = document.createElement("div");
  anchor.id = "analyze-anchor";
  anchor.style.height = "1px";
  anchor.style.marginTop = "-200px";
  output.parentNode.insertBefore(anchor, output);

  // –°–∫—Ä–æ–ª–ª–∏–º —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
  setTimeout(() => {
    anchor.scrollIntoView({ behavior: "smooth", block: "start" });
  }, 100);
}
}

  document.getElementById("analyze-anchor").scrollIntoView({ behavior: "smooth", block: "start" });
  updateVisibleLanguageText();
}
</script>
<!-- –í–°–¢–ê–í–õ–ï–ù–ù–´–ô –°–ö–†–ò–ü–¢ –î–õ–Ø –ü–û–î–°–í–ï–¢–ö–ò -->
<style>
.analysis-highlight {
  background-color: #ffe082 !important;
}

.top-right-button {
  position: absolute;
  top: 1.2rem;
  right: 2rem;
  z-index: 1000;
}


.styled-select {
  background: #fff;
  border: 2px solid #caa98c;
  border-radius: 8px;
  padding: 0.5rem 1rem;
  padding-right: 2rem;
  font-size: 1rem;
  color: #333;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  background-image: url('data:image/svg+xml;utf8,<svg fill="%23666" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
  background-repeat: no-repeat;
  background-position: right 0.8rem center;
  background-size: 1rem;
  font-family: 'Source Code Pro', monospace;
}







select, #combo1, #combo2, #select1, #select2 {
  background: #fff;
  border: 2px solid #caa98c;
  border-radius: 8px;
  padding: 0.6rem 1.2rem;
  padding-right: 3rem;
  font-size: 1.1rem;
  min-width: 80px;
  color: #333;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  background-image: url('data:image/svg+xml;utf8,<svg fill="%23666" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
  background-repeat: no-repeat;
  background-position: right 0.8rem center;
  background-size: 1rem;
  font-family: 'Source Code Pro', monospace;
}


.lang-ru, .lang-uk, .lang-en, .lang-de {
  display: none;
}
.lang-visible {
  display: block !important;
}
</style>
<script>
function attachSumHighlights() {
  document.querySelectorAll("#analysis-output table").forEach((tbl, tIdx) => {
    const tds = tbl.querySelectorAll("td[data-val]");

    tbl.querySelectorAll(".sum-row").forEach((cell, rowIndex) => {
      cell.addEventListener("mouseenter", () => {
        tds.forEach(td => {
          if (+td.parentElement.rowIndex === rowIndex + 1) td.classList.add("analysis-highlight");
        });
      });
      cell.addEventListener("mouseleave", () => {
        tds.forEach(td => td.classList.remove("analysis-highlight"));
      });
    });

    tbl.querySelectorAll(".sum-col").forEach((cell, colIndex) => {
      cell.addEventListener("mouseenter", () => {
        tds.forEach(td => {
          const tdCol = td.cellIndex;
          if (tdCol === colIndex) td.classList.add("analysis-highlight");
        });
      });
      cell.addEventListener("mouseleave", () => {
        tds.forEach(td => td.classList.remove("analysis-highlight"));
      });
    });

    tbl.querySelectorAll(".sum-diag").forEach((cell, i) => {
      cell.addEventListener("mouseenter", () => {
        tds.forEach(td => {
          const row = td.parentElement.rowIndex - 1;
          const col = td.cellIndex;
          if ((i === 0 && row + col === 2) || (i === 1 && row === col)) {
            td.classList.add("analysis-highlight");
          }
        });
      });
      cell.addEventListener("mouseleave", () => {
        tds.forEach(td => td.classList.remove("analysis-highlight"));
      });
    });
  });
}

const origAnalyze = window.autoAnalyzeSquare;
window.autoAnalyzeSquare = function() {
  origAnalyze();
  setTimeout(attachSumHighlights, 100);
};
</script>
<!-- –ö–û–ù–ï–¶ –°–ö–†–ò–ü–¢–ê -->
<script>
const keys = ["123","456","789","867","291","534","675","918","342","597","831","264","315","648","972","753","186","429","945","378","612","483","726","159","237","561","894","147","258","369"];

function permute(str) {
  if (str.length <= 1) return [str];
  const result = [];
  for (let i = 0; i < str.length; i++) {
    const rest = str.slice(0, i) + str.slice(i + 1);
    for (const p of permute(rest)) result.push(str[i] + p);
  }
  return [...new Set(result)];
}

function updateOrderSelect(id, key) {
  const select = document.getElementById(id);
  const orders = permute(key);
  select.innerHTML = '';
  orders.forEach(p => {
    const opt = document.createElement('option');
    opt.value = p;
    opt.textContent = p;
    select.appendChild(opt);
  });
}

function hasCommonDigit(arr1, arr2) {
  return arr1.some(d => arr2.includes(d));
}

function buildSquare() {
  const k1 = document.getElementById('order1').value.split('').map(Number);
  const k2 = document.getElementById('order2').value.split('').map(Number);
  if (hasCommonDigit(k1, k2)) {
    alert("–ö–ª—é—á–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Ü–∏—Ñ—Ä. –í—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–∏–µ.");
    return;
  }

  const col1 = [
    parseInt(`${k1[0]}${k2[0]}`),
    parseInt(`${k1[1]}${k2[1]}`),
    parseInt(`${k1[2]}${k2[2]}`)
  ];
  const col2 = [
    parseInt(`${k1[1]}${k2[2]}`),
    parseInt(`${k1[2]}${k2[0]}`),
    parseInt(`${k1[0]}${k2[1]}`)
  ];
  const d1 = col2[0].toString().padStart(2, '0').split('');
  const d2 = col2[1].toString().padStart(2, '0').split('');
  const d3 = col2[2].toString().padStart(2, '0').split('');
  const col3 = [
    parseInt(`${d2[0]}${d3[1]}`),
    parseInt(`${d3[0]}${d1[1]}`),
    parseInt(`${d1[0]}${d2[1]}`)
  ];
  const square = [
    [col1[0], col2[0], col3[0]],
    [col1[1], col2[1], col3[1]],
    [col1[2], col2[2], col3[2]]
  ];
  drawSquare(square);
  setTimeout(() => drawLines(square), 100);
  document.getElementById("square").scrollIntoView({ behavior: "smooth", block: "center" });
}

function drawSquare(square) {
  const table = document.getElementById('square');
  table.innerHTML = '';
  for (let i = 0; i < 3; i++) {
    const row = document.createElement('tr');
    for (let j = 0; j < 3; j++) {
      const cell = document.createElement('td');
      const val = square[i][j].toString().padStart(2, '0').split('');
      val.forEach(d => {
        const span = document.createElement('span');
        span.className = 'digit-span';
        span.textContent = d;
        span.setAttribute("data-digit", d);

        span.addEventListener("mouseenter", () => {
          const digit = span.getAttribute("data-digit");
          document.querySelectorAll(".digit-span").forEach(s => {
            if (s.getAttribute("data-digit") === digit) {
              s.classList.add("highlighted");
              s.classList.remove("dimmed");
            } else {
              s.classList.add("dimmed");
              s.classList.remove("highlighted");
            }
          });
          document.querySelectorAll("#lines line").forEach(line => {
            if (line.getAttribute("data-digit") === digit) {
              line.classList.add("highlighted");
              line.classList.remove("dimmed");
            } else {
              line.classList.add("dimmed");
              line.classList.remove("highlighted");
            }
          });
        });

        span.addEventListener("mouseleave", () => {
          document.querySelectorAll(".digit-span, #lines line").forEach(el => {
            el.classList.remove("dimmed", "highlighted");
          });
        });
        cell.appendChild(span);
      });
      cell.setAttribute("data-val", square[i][j]);
      const dot = document.createElement('div');
      dot.className = 'center-dot';
      cell.appendChild(dot);
      row.appendChild(cell);
    }
    table.appendChild(row);
  }
}

function drawLines(square) {
  const svg = document.getElementById('lines');
  const table = document.getElementById('square');
  const svgRect = svg.getBoundingClientRect();
  svg.innerHTML = '';

  const digitMap = {};
  const palette = {
    "1": "red", "2": "blue", "3": "green", "4": "orange", "5": "purple",
    "6": "teal", "7": "brown", "8": "magenta", "9": "gold"
  };

  const cells = [...table.querySelectorAll('td')];
  cells.forEach(td => {
    const val = td.getAttribute("data-val");
    const digits = val.toString().padStart(2, '0').split('');
    const box = td.getBoundingClientRect();
    const cx = box.left + box.width / 2 - svgRect.left;
    const cy = box.top + box.height / 2 - svgRect.top;

    digits.forEach(d => {
      if (!digitMap[d]) digitMap[d] = [];
      digitMap[d].push({ x: cx, y: cy });
    });
  });

  Object.keys(digitMap).forEach(d => {
    const spans = document.querySelectorAll(`.digit-span[data-digit='${d}']`);
    spans.forEach(span => {
      span.style.color = palette[d] || "gray";
    });
  });

  let digitOrder = Object.keys(digitMap).sort();
  let globalDelay = 0;

  digitOrder.forEach(digit => {
    const points = digitMap[digit];
    const color = palette[digit] || "gray";

    for (let i = 0; i < points.length; i++) {
      for (let j = i + 1; j < points.length; j++) {
        const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
        line.setAttribute("x1", points[i].x);
        line.setAttribute("y1", points[i].y);
        line.setAttribute("x2", points[j].x);
        line.setAttribute("y2", points[j].y);
        line.setAttribute("stroke", color);
        line.setAttribute("stroke-width", "3");
        line.setAttribute("data-digit", digit);
        line.classList.add("animated");
        setTimeout(() => svg.appendChild(line), globalDelay);
        globalDelay += 400;
      }
    }
  });
}


function disableInvalidKeys() {
  const selected = document.getElementById('order1').value;
  const digits = selected.split('');
  const key2 = document.getElementById('key2');
  Array.from(key2.options).forEach(opt => {
    const overlap = opt.value.split('').some(d => digits.includes(d));
    opt.disabled = overlap;
    opt.style.color = overlap ? '#aaa' : '#000';
  });
  if (key2.options[key2.selectedIndex].disabled) {
    for (let opt of key2.options) {
      if (!opt.disabled) {
        key2.value = opt.value;
        updateOrderSelect('order2', opt.value);
        break;
      }
    }
  }
}


document.addEventListener('DOMContentLoaded', function () {
  const key1 = document.getElementById('key1');
const order1 = document.getElementById('order1');
const key2 = document.getElementById('key2');
  console.log("KEYS:", keys);
  console.log("key1 element:", key1);

  keys.forEach(k => {
    key1.innerHTML += `<option value="${k}">${k}</option>`;
    key2.innerHTML += `<option value="${k}">${k}</option>`;
  });

  setTimeout(() => {
  updateOrderSelect('order1', "147");
  setTimeout(disableInvalidKeys, 0); setTimeout(disableInvalidKeys, 0);
    updateOrderSelect('order2', "369");
    key1.value = "147";
    key2.value = "369";
    key1.addEventListener('change', e => { updateOrderSelect('order1', e.target.value); setTimeout(disableInvalidKeys, 0); });
    key2.addEventListener('change', e => updateOrderSelect('order2', e.target.value));
    console.log("Initialization done. key1 options now:", key1.innerHTML);
  }, 0);
});
</script>
<div class="tooltip" id="tooltip"></div>
<script>
  const tooltip = document.getElementById("tooltip");

  document.querySelectorAll("[data-tooltip]").forEach(el => {
    el.addEventListener("mouseenter", e => {
      tooltip.textContent = el.getAttribute("data-tooltip");
      tooltip.classList.add("visible");
    });
    el.addEventListener("mousemove", e => {
      tooltip.style.left = e.pageX + 15 + "px";
      tooltip.style.top = e.pageY + 15 + "px";
    });
    el.addEventListener("mouseleave", () => {
      tooltip.classList.remove("visible");
    });
  });
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const btn = document.getElementById("start-intro");
  if (btn) {
    btn.addEventListener("click", () => { startIntroStep();
    setTimeout(() => document.getElementById("intro-anchor").scrollIntoView({ behavior: "smooth", block: "start" }), 100); });
  }
});
</script>
<script>
function getPermutations(str) {
  if (str.length <= 1) return [str];
  const perms = [];
  for (let i = 0; i < str.length; i++) {
    const char = str[i];
    const rest = str.slice(0, i) + str.slice(i + 1);
    for (const p of getPermutations(rest)) {
      perms.push(char + p);
    }
  }
  return [...new Set(perms)];
}

function removeStepsAfter(n) {
  for (let i = n + 1; i <= 10; i++) {
    const el = document.getElementById("step" + i);
    if (el) el.remove();
  }
}

function startIntroStep() {
  ['step1','step2','step3','step4'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.remove();
  });
  
  const allKeys = [...document.getElementById('key1').options].map(opt => opt.value);
  const output = document.getElementById('intro-step-output');
  output.innerHTML = "";

  removeStepsAfter(0);
const step1 = document.createElement("div");
  step1.id = "step1";
document.querySelectorAll('.step-card').forEach(el => el.classList.remove('active'));
step1.className = "step-card active";
  step1.style.padding = "1rem";
  step1.style.maxWidth = "600px";
  step1.style.margin = "auto";
  step1.style.background = "#fff8e1";
  step1.style.borderRadius = "12px";
  step1.style.boxShadow = "0 2px 6px rgba(0,0,0,0.1)";
  
step1.innerHTML = `
  <div class="step1-text">
    <h3 class="lang-ru">–®–∞–≥ 1: –í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–≤—ã–π –∫–ª—é—á</h3>
    <h3 class="lang-uk">–ö—Ä–æ–∫ 1: –û–±–µ—Ä—ñ—Ç—å –ø–µ—Ä—à–∏–π –∫–ª—é—á</h3>
    <h3 class="lang-en">Step 1: Choose the first key</h3>
    <h3 class="lang-de">Schritt 1: W√§hle den ersten Schl√ºssel</h3>

    <p class="lang-ru">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª—é—á –∏ –µ–≥–æ –∫–æ–º–±–∏–Ω–∞—Ü–∏—é –æ—Ç –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–æ–∫ —Ü–∏—Ñ—Ä –≤ —á–∏—Å–ª–µ.</p>
    <p class="lang-uk">–û–±–µ—Ä—ñ—Ç—å –∫–ª—é—á —Ç–∞ –π–æ–≥–æ –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—é –∑ –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–æ–∫ —Ü–∏—Ñ—Ä —É —á–∏—Å–ª—ñ.</p>
    <p class="lang-en">Choose a key and its permutation of digits.</p>
    <p class="lang-de">W√§hle einen Schl√ºssel und seine Ziffernpermutation.</p>
  </div>
`;
setTimeout(updateVisibleLanguageText, 0);


  const select1 = document.createElement("select");
  select1.style.fontSize = "1.2rem";
  select1.classList.add("styled-select");
  select1.style.padding = "0.5rem";
  select1.style.marginTop = "1rem";
  allKeys.forEach(k => {
    const opt = document.createElement("option");
    opt.value = k;
    opt.textContent = k;
    select1.appendChild(opt);
  });

  const comboSelect1 = document.createElement("select");
  comboSelect1.id = "combo1";
  comboSelect1.classList.add("styled-select");
  comboSelect1.style.fontSize = "1.2rem";
  comboSelect1.style.padding = "0.5rem";
  comboSelect1.style.marginLeft = "1rem";

  select1.addEventListener("change", () => {
    const perms = getPermutations(select1.value);
    comboSelect1.innerHTML = "";
    perms.forEach(p => {
      const opt = document.createElement("option");
      opt.value = p;
      opt.textContent = p;
      comboSelect1.appendChild(opt);
    });
  });
  select1.dispatchEvent(new Event("change"));

  const nextBtn = document.createElement("button");
  nextBtn.textContent = "‚û°";
  nextBtn.style.marginTop = "1rem";
  nextBtn.onclick = () => {
  ["step3", "step4"].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.remove();
  });
  ["step2", "step3", "step4"].forEach(id => { const el = document.getElementById(id); if (el) el.remove(); });
    const combo1 = comboSelect1.value;
    const chosen1 = combo1.split('');

    removeStepsAfter(1);
const step2 = document.createElement("div");
    step2.id = "step2";
document.querySelectorAll('.step-card').forEach(el => el.classList.remove('active'));
step2.className = "step-card active";
    step2.style.padding = "1rem";
    step2.style.marginTop = "2rem";
    step2.style.background = "#e3f2fd";
    step2.style.borderRadius = "12px";
    step2.style.boxShadow = "0 2px 6px rgba(0,0,0,0.1)";
    step2.innerHTML = `
      <h3 class="lang-ru">–®–∞–≥ 2: –í—ã–±–µ—Ä–∏—Ç–µ –≤—Ç–æ—Ä–æ–π –∫–ª—é—á</h3>
      <h3 class="lang-uk">–ö—Ä–æ–∫ 2: –û–±–µ—Ä—ñ—Ç—å –¥—Ä—É–≥–∏–π –∫–ª—é—á</h3>
      <h3 class="lang-en">Step 2: Choose the second key</h3>
      <h3 class="lang-de">Schritt 2: W√§hle den zweiten Schl√ºssel</h3>

      <p class="lang-ru">–í—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–≤—ã–π –∫–ª—é—á: <strong>` + combo1 + `</strong></p>
      <p class="lang-uk">–û–±—Ä–∞–Ω–∏–π –ø–µ—Ä—à–∏–π –∫–ª—é—á: <strong>` + combo1 + `</strong></p>
      <p class="lang-en">Selected first key: <strong>` + combo1 + `</strong></p>
      <p class="lang-de">Ausgew√§hlter erster Schl√ºssel: <strong>` + combo1 + `</strong></p>

      <p class="lang-ru">–¢–µ–ø–µ—Ä—å –≤—ã–±–µ—Ä–∏—Ç–µ –∫–ª—é—á, –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —Ü–∏—Ñ—Ä—ã: <strong>` + chosen1.join(', ') + `</strong></p>
      <p class="lang-uk">–¢–µ–ø–µ—Ä –æ–±–µ—Ä—ñ—Ç—å –∫–ª—é—á, —â–æ –Ω–µ –º—ñ—Å—Ç–∏—Ç—å —Ü–∏—Ñ—Ä–∏: <strong>` + chosen1.join(', ') + `</strong></p>
      <p class="lang-en">Now choose a key that does not contain digits: <strong>` + chosen1.join(', ') + `</strong></p>
      <p class="lang-de">W√§hle nun einen Schl√ºssel ohne die Ziffern: <strong>` + chosen1.join(', ') + `</strong></p>
    `;
    setTimeout(updateVisibleLanguageText, 0);

    const select2 = document.createElement("select");
    select2.style.fontSize = "1.2rem";
    select2.classList.add("styled-select");
    select2.style.padding = "0.5rem";

    allKeys.forEach(k => {
      if (!k.split('').some(d => chosen1.includes(d))) {
        const opt = document.createElement("option");
        opt.value = k;
        opt.textContent = k;
        select2.appendChild(opt);
      }
    });

    const comboSelect2 = document.createElement("select");
    comboSelect2.id = "combo2";
    comboSelect2.classList.add("styled-select");
    comboSelect2.style.fontSize = "1.2rem";
    comboSelect2.style.padding = "0.5rem";
    comboSelect2.style.marginLeft = "1rem";

    select2.addEventListener("change", () => {
      const perms = getPermutations(select2.value);
      comboSelect2.innerHTML = "";
      perms.forEach(p => {
        const opt = document.createElement("option");
        opt.value = p;
        opt.textContent = p;
        comboSelect2.appendChild(opt);
      });
    });
    select2.dispatchEvent(new Event("change"));

    const nextBtn2 = document.createElement("button");
    nextBtn2.textContent = "‚û°";
    nextBtn2.style.marginTop = "1rem";
    nextBtn2.onclick = () => {
  removeStepsAfter(3);
const combo2 = comboSelect2.value;
      const chosen2 = combo2.split('');
      const col1 = [
        parseInt(chosen1[0] + chosen2[0]),
        parseInt(chosen1[1] + chosen2[1]),
        parseInt(chosen1[2] + chosen2[2])
      ];

      removeStepsAfter(2);
const step3 = document.createElement("div");
      step3.id = "step3";
document.querySelectorAll('.step-card').forEach(el => el.classList.remove('active'));
step3.className = "step-card active";
      step3.style.padding = "1rem";
      step3.style.marginTop = "2rem";
      step3.style.background = "#f1f8e9";
      step3.style.borderRadius = "12px";
      step3.style.boxShadow = "0 2px 6px rgba(0,0,0,0.1)";
      step3.innerHTML = `
      <h3 class="lang-ru">–®–∞–≥ 3: –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞</h3>
      <h3 class="lang-uk">–ö—Ä–æ–∫ 3: –ü–æ–±—É–¥–æ–≤–∞ –ø–µ—Ä—à–æ–≥–æ —Å—Ç–æ–≤–ø—Ü—è</h3>
      <h3 class="lang-en">Step 3: Building the first column</h3>
      <h3 class="lang-de">Schritt 3:Konstruktion der ersten Spalte</h3>

      <p class="lang-ru">–†–∞—Å—Å—Ç–∞–≤–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∫–ª—é—á–∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ. –û–Ω–∏ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–ª–∏ –ø–µ—Ä–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü –Ω–∞—à–µ–≥–æ –∫–≤–∞–¥—Ä–∞—Ç–∞.</p>
      <p class="lang-uk">–°—Ç–∞–≤–∏–º–æ –æ–±—Ä–∞–Ω—ñ –∫–ª—é—á—ñ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ. –í–æ–Ω–∏ –ø–æ–±—É–¥—É–≤–∞–ª–∏ –ø–µ—Ä—à–∏–π —Å—Ç–æ–≤–±–µ—Ü—å –Ω–∞—à–æ–≥–æ –∫–≤–∞–¥—Ä–∞—Ç—É.</p>
      <p class="lang-en">Place the selected keys vertically. They form the first column of our square.</p>
      <p class="lang-de">Ordnen Sie die gew√§hlten Schl√ºssel vertikal an. Sie bilden die erste Spalte unseres Quadrats.</p>
    `;
    setTimeout(updateVisibleLanguageText, 0);

      
      const table = document.createElement("table");
      table.style.borderCollapse = "collapse";
      table.style.margin = "1rem auto";
      table.style.background = "#fff";
      table.style.boxShadow = "0 0 10px rgba(0,0,0,0.05)";
      table.style.border = "2px solid #caa98c";
      table.style.borderRadius = "10px";

      for (let i = 0; i < 3; i++) {
        const tr = document.createElement("tr");

        const td1 = document.createElement("td");
        td1.textContent = col1[i];
        td1.style.fontFamily = "'Fira Mono', monospace";
        td1.style.fontSize = "1.8rem";
        td1.style.border = "1px solid #aaa";
        td1.style.padding = "1rem";
        td1.style.background = "#f5f5f5";
        tr.appendChild(td1);

        const td2 = document.createElement("td");
        td2.textContent = "";
        td2.style.border = "1px solid #aaa";
        td2.style.padding = "1rem";
        td2.style.background = "#ffffff";
        tr.appendChild(td2);

        const td3 = document.createElement("td");
        td3.textContent = "";
        td3.style.border = "1px solid #aaa";
        td3.style.padding = "1rem";
        td3.style.background = "#ffffff";
        tr.appendChild(td3);

        table.appendChild(tr);
      }

      step3.appendChild(table);
      output.appendChild(step3);

      const nextBtn3 = document.createElement("button");
      nextBtn3.textContent = "‚û°";
      nextBtn3.style.marginTop = "1rem";
      nextBtn3.onclick = () => {
  removeStepsAfter(3);
const digits = col1.map(n => n.toString().padStart(2, '0').split(''));
        const top2 = parseInt(digits[1][0] + digits[2][1]);

        const step4 = document.createElement("div");
        step4.id = "step4";
document.querySelectorAll('.step-card').forEach(el => el.classList.remove('active'));
step4.className = "step-card active";
        step4.style.padding = "1rem";
        step4.style.marginTop = "2rem";
        step4.style.background = "#ede7f6";
        step4.style.borderRadius = "12px";
        step4.style.boxShadow = "0 2px 6px rgba(0,0,0,0.1)";
        step4.innerHTML = `
      <h3 class="lang-ru">–®–∞–≥ 4: –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≤–µ—Ä—Ö–Ω–µ–≥–æ —á–∏—Å–ª–∞ –≤—Ç–æ—Ä–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞</h3>
      <h3 class="lang-uk">–ö—Ä–æ–∫ 4: –ü–æ–±—É–¥–æ–≤–∞ –≤–µ—Ä—Ö–Ω—å–æ–≥–æ —á–∏—Å–ª–∞ –¥—Ä—É–≥–æ–≥–æ —Å—Ç–æ–≤–ø—Ü—è</h3>
      <h3 class="lang-en">Step 4: Constructing the top number of the second column</h3>
      <h3 class="lang-de">Schritt 4: Konstruktion der oberen Zahl der zweiten Spalte</h3>

      <p class="lang-ru">–°–æ–µ–¥–∏–Ω—è–µ–º –ø–µ—Ä–≤—É—é —Ü–∏—Ñ—Ä—É —Å—Ä–µ–¥–Ω–µ–≥–æ —á–∏—Å–ª–∞ —Å–æ –≤—Ç–æ—Ä–æ–π —Ü–∏—Ñ—Ä–æ–π –Ω–∏–∂–Ω–µ–≥–æ —á–∏—Å–ª–∞. –í–º–µ—Å—Ç–µ –æ–Ω–∏ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–ª–∏ –≤–µ—Ä—Ö–Ω–µ–µ —á–∏—Å–ª–æ –≤—Ç–æ—Ä–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞.</p>
           <p class="lang-uk">–ó'—î–¥–Ω—É—î–º–æ –ø–µ—Ä—à—É —Ü–∏—Ñ—Ä—É —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ —á–∏—Å–ª–∞ –∑ –¥—Ä—É–≥–æ—é —Ü–∏—Ñ—Ä–æ—é –Ω–∏–∂–Ω—å–æ–≥–æ —á–∏—Å–ª–∞. –†–∞–∑–æ–º –≤–æ–Ω–∏ —Å—Ñ–æ—Ä–º—É–≤–∞–ª–∏ –≤–µ—Ä—Ö–Ω—î —á–∏—Å–ª–æ –¥—Ä—É–≥–æ–≥–æ —Å—Ç–æ–≤–±—Ü—è.</p>
      <p class="lang-en">Combine the first digit of the middle number with the second digit of the bottom number. Together, they form the top number of the second column.</p>
      <p class="lang-de">Verbinden Sie die erste Ziffer der mittleren Zahl mit der zweiten Ziffer der unteren Zahl. Gemeinsam bilden sie die obere Zahl der zweiten Spalte.

</p>
<p><strong>${digits[1][0]}</strong>  + <strong>${digits[2][1]}</strong>  ‚Üí <strong>${top2}</strong></p>
    `;
    setTimeout(updateVisibleLanguageText, 0);

        const table = document.createElement("table");
        table.style.borderCollapse = "collapse";
        table.style.margin = "1rem auto";
        table.style.background = "#fff";
        table.style.boxShadow = "0 0 10px rgba(0,0,0,0.05)";
        table.style.border = "2px solid #caa98c";
        table.style.borderRadius = "10px";

        for (let i = 0; i < 3; i++) {
          const tr = document.createElement("tr");

          const td1 = document.createElement("td");
          td1.textContent = col1[i];
          td1.style.fontFamily = "'Fira Mono', monospace";
          td1.style.fontSize = "1.8rem";
          td1.style.border = "1px solid #aaa";
          td1.style.padding = "1rem";
          td1.style.background = "#f5f5f5";
          tr.appendChild(td1);

          const td2 = document.createElement("td");
          td2.textContent = i === 0 ? top2 : "";
          td2.style.fontFamily = "'Fira Mono', monospace";
          td2.style.fontSize = "1.8rem";
          td2.style.border = "1px solid #aaa";
          td2.style.padding = "1rem";
          td2.style.background = i === 0 ? "#e1f5fe" : "#ffffff";
          tr.appendChild(td2);

          const td3 = document.createElement("td");
          td3.textContent = "";
          td3.style.border = "1px solid #aaa";
          td3.style.padding = "1rem";
          td3.style.background = "#ffffff";
          tr.appendChild(td3);

          table.appendChild(tr);
        }

        step4.appendChild(table);
        const nextBtn4 = document.createElement("button");
        nextBtn4.textContent = "‚û°";
        nextBtn4.style.marginTop = "1rem";
        nextBtn4.onclick = () => {
  removeStepsAfter(4);
const col2_1 = parseInt(chosen1[2] + chosen2[0]);

          const step5 = document.createElement("div");
          step5.id = "step5";
document.querySelectorAll('.step-card').forEach(el => el.classList.remove('active'));
step5.className = "step-card active";
          step5.style.padding = "1rem";
          step5.style.marginTop = "2rem";
          step5.style.background = "#fff3e0";
          step5.style.borderRadius = "12px";
          step5.style.boxShadow = "0 2px 6px rgba(0,0,0,0.1)";
          step5.innerHTML = `
      <h3 class="lang-ru">–®–∞–≥ 5: –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å—Ä–µ–¥–Ω–µ–≥–æ —á–∏—Å–ª–∞ –≤—Ç–æ—Ä–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞</h3>
      <h3 class="lang-uk">–ö—Ä–æ–∫ 5: –ü–æ–±—É–¥–æ–≤–∞ —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ —á–∏—Å–ª–∞ –¥—Ä—É–≥–æ–≥–æ —Å—Ç–æ–≤–ø—Ü—è</h3>
      <h3 class="lang-en">Step 5: Constructing the middle number of the second column</h3>
      <h3 class="lang-de">Schritt 5: Konstruktion der mittleren Zahl der zweiten Spalte</h3>

      <p class="lang-ru">–°–æ–µ–¥–∏–Ω—è–µ–º –ø–µ—Ä–≤—É—é —Ü–∏—Ñ—Ä—É –Ω–∏–∂–Ω–µ–≥–æ —á–∏—Å–ª–∞ —Å –≤—Ç–æ—Ä–æ–π —Ü–∏—Ñ—Ä–æ–π –≤–µ—Ä—Ö–Ω–µ–≥–æ —á–∏—Å–ª–∞. –í–º–µ—Å—Ç–æ –æ–Ω–∏ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–ª–∏ —Å—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–∞ –≤—Ç–æ—Ä–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞.</p>
      <p class="lang-uk">–ó'—î–¥–Ω—É—î–º–æ –ø–µ—Ä—à—É —Ü–∏—Ñ—Ä—É –Ω–∏–∂–Ω—å–æ–≥–æ —á–∏—Å–ª–∞ –∑ –¥—Ä—É–≥–æ—é —Ü–∏—Ñ—Ä–æ—é –≤–µ—Ä—Ö–Ω—å–æ–≥–æ —á–∏—Å–ª–∞. –†–∞–∑–æ–º –≤–æ–Ω–∏ —Ñ–æ—Ä—É–º–∞—é—Ç—å —Å–µ—Ä–µ–¥–Ω—î —á–∏—Å–ª–æ –¥—Ä—É–≥–æ–≥–æ —Å—Ç–æ–≤–ø—Ü—è.</p>
      <p class="lang-en">Combine the first digit of the bottom number with the second digit of the top number. Together, they form the middle number of the second column.</p>
      <p class="lang-de">Verbinden Sie die erste Ziffer der unteren Zahl mit der zweiten Ziffer der oberen Zahl. Gemeinsam bilden sie die mittlere Zahl der zweiten Spalte.</p>
<p><strong>${chosen1[2]}</strong>  + <strong>${chosen2[0]}</strong>  ‚Üí <strong>${col2_1}</strong></p>
    `;
    setTimeout(updateVisibleLanguageText, 0);

          const table = document.createElement("table");
          table.style.borderCollapse = "collapse";
          table.style.margin = "1rem auto";
          table.style.background = "#fff";
          table.style.boxShadow = "0 0 10px rgba(0,0,0,0.05)";
          table.style.border = "2px solid #caa98c";
          table.style.borderRadius = "10px";

          for (let i = 0; i < 3; i++) {
            const tr = document.createElement("tr");

            const td1 = document.createElement("td");
            td1.textContent = col1[i];
            td1.style.fontFamily = "'Fira Mono', monospace";
            td1.style.fontSize = "1.8rem";
            td1.style.border = "1px solid #aaa";
            td1.style.padding = "1rem";
            td1.style.background = "#f5f5f5";
            tr.appendChild(td1);

            const td2 = document.createElement("td");
            td2.textContent = i === 0 ? document.querySelector("#step4 table tr:nth-child(1) td:nth-child(2)").textContent : (i === 1 ? col2_1 : "");
            td2.style.fontFamily = "'Fira Mono', monospace";
            td2.style.fontSize = "1.8rem";
            td2.style.border = "1px solid #aaa";
            td2.style.padding = "1rem";
            td2.style.background = (i === 1 ? "#e8f5e9" : "#ffffff");
            tr.appendChild(td2);

            const td3 = document.createElement("td");
            td3.textContent = "";
            td3.style.border = "1px solid #aaa";
            td3.style.padding = "1rem";
            td3.style.background = "#ffffff";
            tr.appendChild(td3);

            table.appendChild(tr);
          }

          step5.appendChild(table);
        const nextBtn5 = document.createElement("button");
        nextBtn5.textContent = "‚û°";
        nextBtn5.style.marginTop = "1rem";
        nextBtn5.onclick = () => {
  const col2 = [
    parseInt(chosen1[1] + chosen2[2]),
    parseInt(chosen1[2] + chosen2[0]),
    parseInt(chosen1[0] + chosen2[1])
  ];
          removeStepsAfter(5);
const col2_2 = parseInt(chosen1[0] + chosen2[1]);

          const step6 = document.createElement("div");
          step6.id = "step6";
document.querySelectorAll('.step-card').forEach(el => el.classList.remove('active'));
step6.className = "step-card active";
          step6.style.padding = "1rem";
          step6.style.marginTop = "2rem";
          step6.style.background = "#fff3e0";
          step6.style.borderRadius = "12px";
          step6.style.boxShadow = "0 2px 6px rgba(0,0,0,0.1)";
          step6.innerHTML = `
      <h3 class="lang-ru">–®–∞–≥ 6: –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –Ω–∏–∂–Ω–µ–≥–æ —á–∏—Å–ª–∞ –≤—Ç–æ—Ä–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞.</h3>
      <h3 class="lang-uk">–ö—Ä–æ–∫ 6: –ü–æ–±—É–¥–æ–≤–∞ –Ω–∏–∂–Ω—å–æ–≥–æ —á–∏—Å–ª–∞ –¥—Ä—É–≥–æ–≥–æ —Å—Ç–æ–≤–ø—Ü—è.</h3>
      <h3 class="lang-en">Step 6: Constructing the bottom number of the second column</h3>
      <h3 class="lang-de">Schritt 6: Konstruktion der unteren Zahl der zweiten Spalte</h3>

      <p class="lang-ru">–¢–µ–ø–µ—Ä—å —Å–æ–µ–¥–Ω–∏—è–µ–º –ø–µ—Ä–≤—É—é —Ü–∏—Ñ—Ä—É –≤–µ—Ä—Ö–Ω–µ–≥–æ —á–∏—Å–ª–∞ —Å–æ –≤—Ç–æ—Ä–æ–π —Ü–∏—Ñ—Ä–æ–π —Å—Ä–µ–¥–Ω–µ–≥–æ —á–∏—Å–ª–∞. –í–º–µ—Å—Ç–æ –æ–Ω–∏ –¥–∞—é—Ç –Ω–∏–∂–Ω–µ–µ —á–∏—Å–ª–æ –≤—Ç–æ—Ä–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞.</p>
      <p class="lang-uk">–¢–µ–ø–µ—Ä –∑'—î–¥–Ω—É—î–º–æ –ø–µ—Ä—à—É —Ü–∏—Ñ—Ä—É –≤–µ—Ä—Ö–Ω—å–æ–≥–æ —á–∏—Å–ª–∞ –∑ –¥—Ä—É–≥–æ—é —Ü–∏—Ñ—Ä–æ—é —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ —á–∏—Å–ª–∞. –†–∞–∑–æ–º –≤–æ–Ω–∏ –¥–∞—é—Ç—å –Ω–∏–∂–Ω—î —á–∏—Å–ª–æ –¥—Ä—É–≥–æ–≥–æ —Å—Ç–æ–≤–ø—Ü—è.</p>
      <p class="lang-en">Now combine the first digit of the top number with the second digit of the middle number. Together, they form the bottom number of the second column.</p>
      <p class="lang-de">Verbinden Sie nun die erste Ziffer der oberen Zahl mit der zweiten Ziffer der mittleren Zahl. Gemeinsam bilden sie die untere Zahl der zweiten Spalte.
</p>
<p><strong>${chosen1[0]}</strong>  + <strong>${chosen2[1]}</strong>  ‚Üí <strong>${col2_2}</strong></p>
    `;
    setTimeout(updateVisibleLanguageText, 0);

          const table = document.createElement("table");
          table.style.borderCollapse = "collapse";
          table.style.margin = "1rem auto";
          table.style.background = "#fff";
          table.style.boxShadow = "0 0 10px rgba(0,0,0,0.05)";
          table.style.border = "2px solid #caa98c";
          table.style.borderRadius = "10px";

          for (let i = 0; i < 3; i++) {
            const tr = document.createElement("tr");

            const td1 = document.createElement("td");
            td1.textContent = col1[i];
            td1.style.fontFamily = "'Fira Mono', monospace";
            td1.style.fontSize = "1.8rem";
            td1.style.border = "1px solid #aaa";
            td1.style.padding = "1rem";
            td1.style.background = "#f5f5f5";
            tr.appendChild(td1);

            const td2 = document.createElement("td");
            
td2.textContent = col2[i];
td2.style.background = (i === 2 ? "#fff3e0" : "#ffffff");

            td2.style.fontFamily = "'Fira Mono', monospace";
            td2.style.fontSize = "1.8rem";
            td2.style.border = "1px solid #aaa";
            td2.style.padding = "1rem";
            tr.appendChild(td2);

            const td3 = document.createElement("td");
            td3.textContent = "";
            td3.style.border = "1px solid #aaa";
            td3.style.padding = "1rem";
            td3.style.background = "#ffffff";
            tr.appendChild(td3);

            table.appendChild(tr);
          }

          step6.appendChild(table);
          
          const nextBtn6 = document.createElement("button");
          nextBtn6.textContent = "‚û°";
          nextBtn6.style.marginTop = "1rem";
          nextBtn6.onclick = () => {
            removeStepsAfter(6);
            const d1 = col2[0].toString().padStart(2, '0').split('');
            const d2 = col2[1].toString().padStart(2, '0').split('');
            const d3 = col2[2].toString().padStart(2, '0').split('');
            const col3 = [
              parseInt(d2[0] + d3[1]),
              parseInt(d3[0] + d1[1]),
              parseInt(d1[0] + d2[1])
            ];

            const step7 = document.createElement("div");
            step7.id = "step7";
document.querySelectorAll('.step-card').forEach(el => el.classList.remove('active'));
step7.className = "step-card active";
            step7.style.padding = "1rem";
            step7.style.marginTop = "2rem";
            step7.style.background = "#e8eaf6";
            step7.style.borderRadius = "12px";
            step7.style.boxShadow = "0 2px 6px rgba(0,0,0,0.1)";
            step7.innerHTML = `
      <h3 class="lang-ru">–®–∞–≥ 7: –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ç—Ä–µ—Ç—å–µ–≥–æ —Å—Ç–æ–ª–±—Ü–∞</h3>
      <h3 class="lang-uk">–ö—Ä–æ–∫ 7: –ü–æ–±—É–¥–æ–≤–∞ —Ç—Ä–µ—Ç—å–æ–≥–æ —Å—Ç–æ–≤–ø—Ü—è</h3>
      <h3 class="lang-en">Step 7: Constructing the third column</h3>
      <h3 class="lang-de">Schritt 7: Konstruktion der dritten Spalte</h3>

      <p class="lang-ru">–ü–æ–≤—Ç–æ—Ä—è–µ–º –ø–æ –æ—á–µ—Ä–µ–¥–∏ —à–∞–≥–∏ –Ω–æ–º–µ—Ä 4, 5 –∏ 6, –Ω–æ —É–∂–µ —Å —á–∏—Å–ª–∞–º–∏ –≤—Ç–æ—Ä–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞. –¢–µ–ø–µ—Ä—å –Ω–∞—à –∫–≤–∞–¥—Ä–∞—Ç –≥–æ—Ç–æ–≤. </p>
      <p class="lang-uk">–ü–æ–≤—Ç–æ—Ä—é—î–º–æ –ø–æ —á–µ—Ä–∑—ñ –∫—Ä–æ–∫–∏ 4, 5 —Ç–∞ 6, –∞–ª–µ –∑ —á–∏—Å–ª–∞–º–∏ –¥—Ä—É–≥–æ–≥–æ —Å—Ç–æ–≤–ø—Ü—è. –¢–µ–ø–µ—Ä –Ω–∞—à –∫–≤–∞–¥—Ä–∞—Ç –≥–æ—Ç–æ–≤–∏–π.</p>
      <p class="lang-en">Repeat steps 4, 5, and 6 in order, but now with the numbers of the second column. Now our square is complete.</p>
      <p class="lang-de">Wiederholen Sie der Reihe nach die Schritte 4, 5 und 6 ‚Äì diesmal jedoch mit den Zahlen der zweiten Spalte. Nun ist unser Quadrat fertig.</p>
    `;
    setTimeout(updateVisibleLanguageText, 0);

            const table = document.createElement("table");
            table.style.borderCollapse = "collapse";
            table.style.margin = "1rem auto";
            table.style.background = "#fff";
            table.style.boxShadow = "0 0 10px rgba(0,0,0,0.05)";
            table.style.border = "2px solid #caa98c";
            table.style.borderRadius = "10px";

            for (let i = 0; i < 3; i++) {
              const tr = document.createElement("tr");

              const td1 = document.createElement("td");
              td1.textContent = col1[i];
              td1.style.fontFamily = "'Fira Mono', monospace";
              td1.style.fontSize = "1.8rem";
              td1.style.border = "1px solid #aaa";
              td1.style.padding = "1rem";
              td1.style.background = "#f5f5f5";
              tr.appendChild(td1);

              const td2 = document.createElement("td");
              td2.textContent = col2[i];
              td2.style.fontFamily = "'Fira Mono', monospace";
              td2.style.fontSize = "1.8rem";
              td2.style.border = "1px solid #aaa";
              td2.style.padding = "1rem";
              td2.style.background = "#ffffff";
              tr.appendChild(td2);

              const td3 = document.createElement("td");
              td3.textContent = col3[i];
              td3.style.fontFamily = "'Fira Mono', monospace";
              td3.style.fontSize = "1.8rem";
              td3.style.border = "1px solid #aaa";
              td3.style.padding = "1rem";
              td3.style.background = "#e8eaf6";
              tr.appendChild(td3);

              table.appendChild(tr);
            }

            step7.appendChild(table);
            
          const nextBtn7 = document.createElement("button");
          nextBtn7.textContent = "‚û°";
          nextBtn7.style.marginTop = "1rem";
          nextBtn7.onclick = () => {
            removeStepsAfter(7);

            const d1 = col2[0].toString().padStart(2, '0').split('');
            const d2 = col2[1].toString().padStart(2, '0').split('');
            const d3 = col2[2].toString().padStart(2, '0').split('');
            const col3 = [
              parseInt(d2[0] + d3[1]),
              parseInt(d3[0] + d1[1]),
              parseInt(d1[0] + d2[1])
            ];
            const square = [
              [col1[0], col2[0], col3[0]],
              [col1[1], col2[1], col3[1]],
              [col1[2], col2[2], col3[2]]
            ];

            drawSquare(square);
            setTimeout(() => drawLines(square), 100);

            const step8 = document.createElement("div");
            step8.id = "step8";
document.querySelectorAll('.step-card').forEach(el => el.classList.remove('active'));
step8.className = "step-card active";
            step8.style.padding = "1rem";
            step8.style.marginTop = "2rem";
            step8.style.background = "#fce4ec";
            step8.style.borderRadius = "12px";
            step8.style.boxShadow = "0 2px 6px rgba(0,0,0,0.1)";
            step8.innerHTML = `
      <h3 class="lang-ru">–®–∞–≥ 8: –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–∞–∫—Ä–∞–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã</h3>
      <h3 class="lang-uk">–ö—Ä–æ–∫ 8: –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è —Å–∞–∫—Ä–∞–ª—å–Ω–æ—ó —Å—Ç—Ä—É–∫—Ç—É—Ä–∏</h3>
      <h3 class="lang-en">Step 8: Visualization of the sacred structure</h3>
      <h3 class="lang-de">Schritt 8: Visualisierung der sakralen Struktur</h3>

      <p class="lang-ru">–û–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Ü–∏—Ñ—Ä—ã –≤ —è—á–µ–π–∫–∞—Ö —Ç–µ–ø–µ—Ä—å —Å–æ–µ–¥–∏–Ω–µ–Ω—ã —Ü–≤–µ—Ç–Ω—ã–º–∏ –ª–∏–Ω–∏—è–º–∏.</p>
      <p class="lang-uk">–û–¥–Ω–∞–∫–æ–≤—ñ —Ü–∏—Ñ—Ä–∏ –≤ –∫–æ–º—ñ—Ä–∫–∞—Ö —Ç–µ–ø–µ—Ä –∑'—î–¥–Ω–∞–Ω—ñ –∫–æ–ª—å–æ—Ä–æ–≤–∏–º–∏ –ª—ñ–Ω—ñ—è–º–∏.</p>
      <p class="lang-en">Identical digits in the cells are now connected by colored lines.</p>
      <p class="lang-de">Gleiche Ziffern in den Zellen sind nun durch farbige Linien verbunden.</p>

      <p class="lang-ru">–ï—Å–ª–∏ —Å–ª–µ–¥–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥–∏–∫–µ ‚Äî —Ü–∏—Ñ—Ä—ã –≤—Å–µ–≥–¥–∞ —Ä–∏—Å—É—é—Ç –≤–æ—Å—å–º–∏–ª—É—á–µ–≤—É—é –∑–≤–µ–∑–¥—É.</p>
      <p class="lang-uk">–Ø–∫—â–æ —Å–ª—ñ–¥—É–≤–∞—Ç–∏ –º–µ—Ç–æ–¥–∏—Ü—ñ ‚Äî —Ü–∏—Ñ—Ä–∏ –∑–∞–≤–∂–¥–∏ —Ñ–æ—Ä–º—É—é—Ç—å –≤–æ—Å—å–º–∏–ø—Ä–æ–º–µ–Ω–µ–≤—É –∑—ñ—Ä–∫—É.</p>
      <p class="lang-en">Following the method, the digits always form an eight-pointed star.</p>
      <p class="lang-de">Wenn man der Methode folgt, bilden die Ziffern stets einen achtzackigen Stern.</p>
    `;
    setTimeout(updateVisibleLanguageText, 0);

            output.appendChild(step8);
            document.getElementById("square").scrollIntoView({ behavior: "smooth", block: "center" });
          };

          step7.appendChild(nextBtn7);

output.appendChild(step7);
          };

          step6.appendChild(nextBtn6);

output.appendChild(step6);
        };

        step5.appendChild(nextBtn5);

          output.appendChild(step5);
        };

        step4.appendChild(nextBtn4);

        output.appendChild(step4);
      };

      step3.appendChild(nextBtn3);

    };

    step2.appendChild(select2);
    step2.appendChild(comboSelect2);
    step2.appendChild(nextBtn2);
    output.appendChild(step2);
  };

  step1.appendChild(select1);
  step1.appendChild(comboSelect1);
  step1.appendChild(nextBtn);
  output.appendChild(step1);
}
</script>
<script>
  let currentStepIndex = 0;

  function showStep(stepNumber, stepId, contentBuilder) {
    const container = document.getElementById("intro-step-output");
    for (let i = stepNumber + 1; i <= 5; i++) {
      const el = document.getElementById("step" + i);
      if (el) el.remove();
    }
    const existing = document.getElementById(stepId);
    if (existing) existing.remove();

    const step = document.createElement("div");
    step.id = stepId;
    contentBuilder(step);
    container.appendChild(step);
    currentStepIndex = stepNumber;
  }
</script>
<script>
  function startStep2() {
    showStep(2, "step2", s => {
      const h = document.createElement("h3");
      h.textContent = "–®–∞–≥ 2: –í—ã–±–µ—Ä–∏—Ç–µ –≤—Ç–æ—Ä–æ–π –∫–ª—é—á";
      s.appendChild(h);

      const info = document.createElement("p");
      info.textContent = "–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª—é—á, –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —Ü–∏—Ñ—Ä—ã –∏–∑ –ø–µ—Ä–≤–æ–≥–æ: " + window.chosenKey1;
      s.appendChild(info);

      const select = document.createElement("select");
      select.id = "chosen2";
      const key1Digits = window.chosenKey1.split("");
      const allKeys = document.getElementById("key1");
      Array.from(allKeys.options).forEach(opt => {
        const digits = opt.value.split("");
        if (digits.every(d => !key1Digits.includes(d))) {
          const o = document.createElement("option");
          o.value = opt.value;
          o.textContent = opt.textContent;
          select.appendChild(o);
        }
      });
      s.appendChild(select);

      const comboSelect = document.createElement("select");
      comboSelect.id = "chosenCombo2";
      s.appendChild(document.createTextNode(" –≤ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ "));
      s.appendChild(comboSelect);

      select.addEventListener("change", () => {
        const val = select.value;
        const digits = val.split("");
        comboSelect.innerHTML = "";
        function permute(arr, m = []) {
          if (arr.length === 0) {
            const opt = document.createElement("option");
            opt.value = m.join("");
            opt.textContent = m.join("");
            comboSelect.appendChild(opt);
          } else {
            for (let i = 0; i < arr.length; i++) {
              const curr = arr.slice();
              const next = curr.splice(i, 1);
              permute(curr.slice(), m.concat(next));
            }
          }
        }
        permute(digits);
      });

      select.dispatchEvent(new Event("change"));

      const btn = document.createElement("button");
      btn.textContent = "‚û°";
      btn.onclick = () => {
        window.chosenKey2 = select.value;
        window.chosenCombo2 = comboSelect.value;
        startStep3();
      };
      s.appendChild(document.createElement("br"));
      s.appendChild(btn);
    });
  }
</script>
<script>
  function startStep3() {
    ["step3", "step4", "step5"].forEach(id => {
      const el = document.getElementById(id);
      if (el) el.remove();
    });

    showStep(3, "step3", s => {
      const h = document.createElement("h3");
      h.textContent = "–®–∞–≥ 3: –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞";
      s.appendChild(h);

      const p = document.createElement("p");
      p.textContent = "–§–æ—Ä–º–∏—Ä—É–µ–º –ø–µ—Ä–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π.";
      s.appendChild(p);

      const pre = document.createElement("pre");
      pre.textContent = "üî¢ " + window.chosenCombo1 + "\nüî¢ " + window.chosenCombo2;
      s.appendChild(pre);

      const btn = document.createElement("button");
      btn.textContent = "‚û°";
      btn.onclick = () => startStep4();
      s.appendChild(btn);
    });
  }
</script>
<script>
document.getElementById("start-intro").addEventListener("click", function () {
  const step1 = document.getElementById("step1");
  if (step1) {
    step1.scrollIntoView({ behavior: "smooth" });
  }
});
</script><script>
document.getElementById("analyze-auto-btn").addEventListener("click", function () {
  autoAnalyzeSquare();
   // –ü–æ–¥–æ–∂–¥–∞—Ç—å –Ω–µ–º–Ω–æ–≥–æ, —á—Ç–æ–±—ã —É—Å–ø–µ–ª –æ—Ç—Ä–µ–Ω–¥–µ—Ä–∏—Ç—å—Å—è –∞–Ω–∞–ª–∏–∑
});
</script>
<script>
const translations = {
  ru: {
    "–û–±—É—á–µ–Ω–∏–µ –≤ –ø–æ—à–∞–≥–æ–≤–æ–º —Ä–µ–∂–∏–º–µ": "–û–±—É—á–µ–Ω–∏–µ –≤ –ø–æ—à–∞–≥–æ–≤–æ–º —Ä–µ–∂–∏–º–µ",
    "–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –∫–≤–∞–¥—Ä–∞—Ç–∞ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ –º–∞–≥–∏—á–µ—Å–∫–∏–π, –µ—Å–ª–∏ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ": "–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –∫–≤–∞–¥—Ä–∞—Ç–∞ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ –º–∞–≥–∏—á–µ—Å–∫–∏–π, –µ—Å–ª–∏ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ",
    "–°–æ–∑–¥–∞—Ç—å –º–∞–≥–∏—á–µ—Å–∫–∏–π –∫–≤–∞–¥—Ä–∞—Ç": "–°–æ–∑–¥–∞—Ç—å –º–∞–≥–∏—á–µ—Å–∫–∏–π –∫–≤–∞–¥—Ä–∞—Ç",
    "–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–≤—ã–π –∫–ª—é—á ‚Äî —Ç—Ä–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ü–∏—Ñ—Ä—ã": "–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–≤—ã–π –∫–ª—é—á ‚Äî —Ç—Ä–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ü–∏—Ñ—Ä—ã",
    "–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Ä—è–¥–æ–∫ —Ü–∏—Ñ—Ä –¥–ª—è –∫–ª—é—á–∞ 1": "–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Ä—è–¥–æ–∫ —Ü–∏—Ñ—Ä –¥–ª—è –∫–ª—é—á–∞ 1",
    "–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ç–æ—Ä–æ–π –∫–ª—é—á ‚Äî —Ç—Ä–∏ –¥—Ä—É–≥–∏–µ —Ü–∏—Ñ—Ä—ã": "–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ç–æ—Ä–æ–π –∫–ª—é—á ‚Äî —Ç—Ä–∏ –¥—Ä—É–≥–∏–µ —Ü–∏—Ñ—Ä—ã",
    "–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Ä—è–¥–æ–∫ —Ü–∏—Ñ—Ä –¥–ª—è –∫–ª—é—á–∞ 2": "–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Ä—è–¥–æ–∫ —Ü–∏—Ñ—Ä –¥–ª—è –∫–ª—é—á–∞ 2",
    "–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏": "–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏",
    "label_key1": "–ö–ª—é—á 1:",
    "label_key2": "–ö–ª—é—á 2:",
    "in_combination": "–≤ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏"
  },
  uk: {
    "–û–±—É—á–µ–Ω–∏–µ –≤ –ø–æ—à–∞–≥–æ–≤–æ–º —Ä–µ–∂–∏–º–µ": "–ù–∞–≤—á–∞–Ω–Ω—è –ø–æ–∫—Ä–æ–∫–æ–≤–æ",
    "–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –∫–≤–∞–¥—Ä–∞—Ç–∞ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ –º–∞–≥–∏—á–µ—Å–∫–∏–π, –µ—Å–ª–∏ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ": "–ê–Ω–∞–ª—ñ–∑ –∫–≤–∞–¥—Ä–∞—Ç–∞ —ñ –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤ –º–∞–≥—ñ—á–Ω–∏–π, —è–∫—â–æ –º–æ–∂–ª–∏–≤–æ",
    "–°–æ–∑–¥–∞—Ç—å –º–∞–≥–∏—á–µ—Å–∫–∏–π –∫–≤–∞–¥—Ä–∞—Ç": "–°—Ç–≤–æ—Ä–∏—Ç–∏ –º–∞–≥—ñ—á–Ω–∏–π –∫–≤–∞–¥—Ä–∞—Ç",
    "–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–≤—ã–π –∫–ª—é—á ‚Äî —Ç—Ä–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ü–∏—Ñ—Ä—ã": "–í–∏–±–µ—Ä—ñ—Ç—å –ø–µ—Ä—à–∏–π –∫–ª—é—á ‚Äî —Ç—Ä–∏ —É–Ω—ñ–∫–∞–ª—å–Ω—ñ —Ü–∏—Ñ—Ä–∏",
    "–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Ä—è–¥–æ–∫ —Ü–∏—Ñ—Ä –¥–ª—è –∫–ª—é—á–∞ 1": "–í–∏–±–µ—Ä—ñ—Ç—å –ø–æ—Ä—è–¥–æ–∫ —Ü–∏—Ñ—Ä –¥–ª—è –∫–ª—é—á–∞ 1",
    "–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ç–æ—Ä–æ–π –∫–ª—é—á ‚Äî —Ç—Ä–∏ –¥—Ä—É–≥–∏–µ —Ü–∏—Ñ—Ä—ã": "–í–∏–±–µ—Ä—ñ—Ç—å –¥—Ä—É–≥–∏–π –∫–ª—é—á ‚Äî —ñ–Ω—à—ñ —Ç—Ä–∏ —Ü–∏—Ñ—Ä–∏",
    "–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Ä—è–¥–æ–∫ —Ü–∏—Ñ—Ä –¥–ª—è –∫–ª—é—á–∞ 2": "–í–∏–±–µ—Ä—ñ—Ç—å –ø–æ—Ä—è–¥–æ–∫ —Ü–∏—Ñ—Ä –¥–ª—è –∫–ª—é—á–∞ 2",
    "–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏": "–ö–æ—Ä–∏—Å–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è",
    "label_key1": "–ö–ª—é—á 1:",
    "label_key2": "–ö–ª—é—á 2:",
    "in_combination": "—É –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó"
  },
  en: {
    "–û–±—É—á–µ–Ω–∏–µ –≤ –ø–æ—à–∞–≥–æ–≤–æ–º —Ä–µ–∂–∏–º–µ": "Step-by-step learning mode",
    "–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –∫–≤–∞–¥—Ä–∞—Ç–∞ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ –º–∞–≥–∏—á–µ—Å–∫–∏–π, –µ—Å–ª–∏ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ": "Analyze the current square and convert to magic if possible",
    "–°–æ–∑–¥–∞—Ç—å –º–∞–≥–∏—á–µ—Å–∫–∏–π –∫–≤–∞–¥—Ä–∞—Ç": "Build the magic square",
    "–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–≤—ã–π –∫–ª—é—á ‚Äî —Ç—Ä–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ü–∏—Ñ—Ä—ã": "Select the first key ‚Äî three unique digits",
    "–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Ä—è–¥–æ–∫ —Ü–∏—Ñ—Ä –¥–ª—è –∫–ª—é—á–∞ 1": "Select the digit order for key 1",
    "–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ç–æ—Ä–æ–π –∫–ª—é—á ‚Äî —Ç—Ä–∏ –¥—Ä—É–≥–∏–µ —Ü–∏—Ñ—Ä—ã": "Select the second key ‚Äî three other digits",
    "–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Ä—è–¥–æ–∫ —Ü–∏—Ñ—Ä –¥–ª—è –∫–ª—é—á–∞ 2": "Select the digit order for key 2",
    "–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏": "Helpful resources",
    "label_key1": "Key 1:",
    "label_key2": "Key 2:",
    "in_combination": "in combination"
  },
  de: {
    "–û–±—É—á–µ–Ω–∏–µ –≤ –ø–æ—à–∞–≥–æ–≤–æ–º —Ä–µ–∂–∏–º–µ": "Schrittweises Lernen",
    "–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –∫–≤–∞–¥—Ä–∞—Ç–∞ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ –º–∞–≥–∏—á–µ—Å–∫–∏–π, –µ—Å–ª–∏ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ": "Analyse des aktuellen Quadrats und Umwandlung in ein magisches Quadrat, wenn m√∂glich",
    "–°–æ–∑–¥–∞—Ç—å –º–∞–≥–∏—á–µ—Å–∫–∏–π –∫–≤–∞–¥—Ä–∞—Ç": "Magisches Quadrat erstellen",
    "–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–≤—ã–π –∫–ª—é—á ‚Äî —Ç—Ä–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ü–∏—Ñ—Ä—ã": "W√§hlen Sie den ersten Schl√ºssel ‚Äì drei eindeutige Ziffern",
    "–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Ä—è–¥–æ–∫ —Ü–∏—Ñ—Ä –¥–ª—è –∫–ª—é—á–∞ 1": "W√§hlen Sie die Ziffernreihenfolge f√ºr Schl√ºssel 1",
    "–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ç–æ—Ä–æ–π –∫–ª—é—á ‚Äî —Ç—Ä–∏ –¥—Ä—É–≥–∏–µ —Ü–∏—Ñ—Ä—ã": "W√§hlen Sie den zweiten Schl√ºssel ‚Äì drei andere Ziffern",
    "–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Ä—è–¥–æ–∫ —Ü–∏—Ñ—Ä –¥–ª—è –∫–ª—é—á–∞ 2": "W√§hlen Sie die Ziffernreihenfolge f√ºr Schl√ºssel 2",
    "–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏": "N√ºtzliche Links",
    "label_key1": "Schl√ºssel 1:",
    "label_key2": "Schl√ºssel 2:",
    "in_combination": "in Kombination"
  }
};

function applyTranslations(language) {
  // data-tooltip
  document.querySelectorAll("[data-tooltip-original]").forEach(el => {
    const original = el.getAttribute("data-tooltip-original");
    const translated = translations[language]?.[original];
    if (translated) {
      el.setAttribute("data-tooltip", translated);
    }
  });

  // data-i18n
  document.querySelectorAll("[data-i18n]").forEach(el => {
    const key = el.getAttribute("data-i18n");
    const translated = translations[language]?.[key];
    if (translated) {
      el.textContent = translated;
    }
  });
}

document.getElementById("language-select").addEventListener("change", e => {
  applyTranslations(e.target.value);
});

document.addEventListener("DOMContentLoaded", () => {
  // data-tooltip-original
  document.querySelectorAll("[data-tooltip]").forEach(el => {
    if (!el.hasAttribute("data-tooltip-original")) {
      el.setAttribute("data-tooltip-original", el.getAttribute("data-tooltip"));
    }
  });
});
</script>
<script>
function updateTranslations(lang) {
  document.querySelectorAll("[data-i18n]").forEach((el) => {
    const key = el.getAttribute("data-i18n");
    const html = el.hasAttribute("data-html");
    if (translations[lang] && translations[lang][key]) {
      if (html) {
        el.innerHTML = translations[lang][key];
      } else {
        el.textContent = translations[lang][key];
      }
    }
  });
}
</script>
<script>
(function() {
  if (typeof window.translationsInitialized !== 'undefined') {
    console.warn("[i18n] üõë Translations already initialized. Skipping duplicate.");
    return;
  }
  window.translationsInitialized = true;

  const translations = {
    ru: {
      training: "üß† –û–±—É—á–∞—é—â–∏–π —Ä–µ–∂–∏–º",
      analyze: "üìä –ê–Ω–∞–ª–∏–∑",
      resources: "üîó –†–µ—Å—É—Ä—Å—ã",
      build: "–ü–æ—Å—Ç—Ä–æ–∏—Ç—å",
      heading: "–ú–∞–≥–∏—á–µ—Å–∫–∏–µ –∫–≤–∞–¥—Ä–∞—Ç—ã",
      subheading: "–ø–æ –º–µ—Ç–æ–¥–∏–∫–µ –ê—Å–ª–∞–Ω–∞ –£–∞—Ä–∑–∏–∞—Ç—ã",
      training_tip: "–û–±—É—á–µ–Ω–∏–µ –≤ –ø–æ—à–∞–≥–æ–≤–æ–º —Ä–µ–∂–∏–º–µ",
      analyze_tip: "–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –∫–≤–∞–¥—Ä–∞—Ç–∞ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ –º–∞–≥–∏—á–µ—Å–∫–∏–π, –µ—Å–ª–∏ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ",
      resources_tip: "–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏",
      how_title: "–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?",
      how_text: "–í—ã–±–µ—Ä–∏—Ç–µ 2 –∫–ª—é—á–∞ ‚Äî —Ç—Ä–æ–π–∫–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ü–∏—Ñ—Ä –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π. –ó–∞—Ç–µ–º –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É <i>¬´–ü–æ—Å—Ç—Ä–æ–∏—Ç—å¬ª</i>, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∫–≤–∞–¥—Ä–∞—Ç.",
    "label_key1": "–ö–ª—é—á 1:",
    "label_key2": "–ö–ª—é—á 2:",
    "in_combination": "–≤ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏"
  },
    uk: {
      training: "üß† –ù–∞–≤—á–∞–ª—å–Ω–∏–π —Ä–µ–∂–∏–º",
      analyze: "üìä –ê–Ω–∞–ª—ñ–∑",
      resources: "üîó –†–µ—Å—É—Ä—Å–∏",
      build: "–ü–æ–±—É–¥—É–≤–∞—Ç–∏",
      heading: "–ú–∞–≥—ñ—á–Ω—ñ –∫–≤–∞–¥—Ä–∞—Ç–∏",
      subheading: "–∑–∞ –º–µ—Ç–æ–¥–∏–∫–æ—é –ê—Å–ª–∞–Ω–∞ –£–∞—Ä–∑—ñ–∞—Ç–∏",
      training_tip: "–ù–∞–≤—á–∞–Ω–Ω—è –ø–æ–∫—Ä–æ–∫–æ–≤–æ",
      analyze_tip: "–ê–Ω–∞–ª—ñ–∑ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–≤–∞–¥—Ä–∞—Ç–∞ —ñ –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤ –º–∞–≥—ñ—á–Ω–∏–π, —è–∫—â–æ —Ü–µ –º–æ–∂–ª–∏–≤–æ",
      resources_tip: "–ö–æ—Ä–∏—Å–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è",
      how_title: "–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î?",
      how_text: "–í–∏–±–µ—Ä—ñ—Ç—å 2 –∫–ª—é—á—ñ ‚Äî —Ç—Ä—ñ–π–∫–∏ —É–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö —Ü–∏—Ñ—Ä –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–µ–Ω—å. –ü–æ—Ç—ñ–º –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É <i>¬´–ü–æ–±—É–¥—É–≤–∞—Ç–∏¬ª</i>, —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ –∫–≤–∞–¥—Ä–∞—Ç.",
    "label_key1": "–ö–ª—é—á 1:",
    "label_key2": "–ö–ª—é—á 2:",
    "in_combination": "—É –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó"
  },
    en: {
      training: "üß† Training Mode",
      analyze: "üìä Analyze",
      resources: "üîó Resources",
      build: "Build",
      heading: "Magic Squares",
      subheading: "based on Aslan Uarziaty's method",
      training_tip: "Step-by-step learning",
      analyze_tip: "Analyze and convert to magic square if possible",
      resources_tip: "Helpful resources",
      how_title: "How does it work?",
      how_text: "Choose 2 keys ‚Äî sets of unique digits without repeats. Then click <i>‚ÄúBuild‚Äù</i> to see the square.",
    "label_key1": "Key 1:",
    "label_key2": "Key 2:",
    "in_combination": "in combination"
  },
    de: {
      training: "üß† Lernmodus",
      analyze: "üìä Analyse",
      resources: "üîó Ressourcen",
      build: "Erstellen",
      heading: "Magische Quadrate",
      subheading: "nach der Methode von Aslan Uarziaty",
      training_tip: "Schrittweises Lernen",
      analyze_tip: "Analyse des aktuellen Quadrats und Umwandlung in ein magisches Quadrat, falls m√∂glich",
      resources_tip: "N√ºtzliche Ressourcen",
      how_title: "Wie funktioniert das?",
      how_text: "W√§hle 2 Schl√ºssel ‚Äî jeweils drei eindeutige Ziffern. Klicke dann auf <i>‚ÄûErstellen‚Äú</i>, um das Quadrat zu sehen.",
    "label_key1": "Schl√ºssel 1:",
    "label_key2": "Schl√ºssel 2:",
    "in_combination": "in Kombination"
  }
  };

  function updateTranslations(lang) {
    console.log("[i18n] Updating translations for language:", lang);
    document.querySelectorAll("[data-i18n]").forEach(el => {
      const key = el.getAttribute("data-i18n");
      if (translations[lang] && translations[lang][key]) {
        if (el.tagName.toLowerCase() === 'p' || el.tagName.toLowerCase() === 'div' || el.hasAttribute("data-html")) {
          el.innerHTML = translations[lang][key];
        } else {
          el.textContent = translations[lang][key];
        }
        console.log(`[i18n] ‚úÖ Updated: [${key}] => "${translations[lang][key]}"`);
      } else {
        console.warn(`[i18n] ‚ö†Ô∏è Missing translation for: [${key}] in [${lang}]`);
      }
    });
    document.querySelectorAll("[data-tooltip-key]").forEach(el => {
      const key = el.getAttribute("data-tooltip-key");
      if (translations[lang] && translations[lang][key]) {
        el.setAttribute("data-tooltip", translations[lang][key]);
        console.log(`[tooltip] ‚úÖ Updated: [${key}] => "${translations[lang][key]}"`);
      } else {
        console.warn(`[tooltip] ‚ö†Ô∏è Missing tooltip for: [${key}] in [${lang}]`);
      }
    });
  }

  document.addEventListener("DOMContentLoaded", () => {
    console.log("[i18n] DOMContentLoaded triggered");
    const selector = document.getElementById("language-select");
    if (!selector) {
      console.error("[i18n] ‚ùå language-select element not found!");
      return;
    }
    console.log("[i18n] language-select element found. Current value:", selector.value);
    updateTranslations(selector.value);
    selector.addEventListener("change", () => {
      console.log("[i18n] Language changed to:", selector.value);
      updateTranslations(selector.value);
    });
  });
})();
</script>
<script>
(function() {
  if (typeof window.translationsInitialized !== 'undefined') {
    console.warn("[i18n] üõë Translations already initialized. Skipping duplicate.");
    return;
  }
  window.translationsInitialized = true;

  const translations = {
    ru: {
      training: "üß† –û–±—É—á–∞—é—â–∏–π —Ä–µ–∂–∏–º",
      analyze: "üìä –ê–Ω–∞–ª–∏–∑",
      resources: "üîó –†–µ—Å—É—Ä—Å—ã",
      build: "–ü–æ—Å—Ç—Ä–æ–∏—Ç—å",
      heading: "–ú–∞–≥–∏—á–µ—Å–∫–∏–µ –∫–≤–∞–¥—Ä–∞—Ç—ã",
      subheading: "–ø–æ –º–µ—Ç–æ–¥–∏–∫–µ –ê—Å–ª–∞–Ω–∞ –£–∞—Ä–∑–∏–∞—Ç—ã",
      training_tip: "–û–±—É—á–µ–Ω–∏–µ –≤ –ø–æ—à–∞–≥–æ–≤–æ–º —Ä–µ–∂–∏–º–µ",
      analyze_tip: "–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –∫–≤–∞–¥—Ä–∞—Ç–∞ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ –º–∞–≥–∏—á–µ—Å–∫–∏–π, –µ—Å–ª–∏ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ",
      resources_tip: "–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏",
      how_title: "–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?",
      how_text: "–í—ã–±–µ—Ä–∏—Ç–µ 2 –∫–ª—é—á–∞ ‚Äî —Ç—Ä–æ–π–∫–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ü–∏—Ñ—Ä –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π. –ó–∞—Ç–µ–º –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É <i>¬´–ü–æ—Å—Ç—Ä–æ–∏—Ç—å¬ª</i>, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∫–≤–∞–¥—Ä–∞—Ç.",
    "label_key1": "–ö–ª—é—á 1:",
    "label_key2": "–ö–ª—é—á 2:",
    "in_combination": "–≤ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏"
  },
    uk: {
      training: "üß† –ù–∞–≤—á–∞–ª—å–Ω–∏–π —Ä–µ–∂–∏–º",
      analyze: "üìä –ê–Ω–∞–ª—ñ–∑",
      resources: "üîó –†–µ—Å—É—Ä—Å–∏",
      build: "–ü–æ–±—É–¥—É–≤–∞—Ç–∏",
      heading: "–ú–∞–≥—ñ—á–Ω—ñ –∫–≤–∞–¥—Ä–∞—Ç–∏",
      subheading: "–∑–∞ –º–µ—Ç–æ–¥–∏–∫–æ—é –ê—Å–ª–∞–Ω–∞ –£–∞—Ä–∑—ñ–∞—Ç–∏",
      training_tip: "–ù–∞–≤—á–∞–Ω–Ω—è –ø–æ–∫—Ä–æ–∫–æ–≤–æ",
      analyze_tip: "–ê–Ω–∞–ª—ñ–∑ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–≤–∞–¥—Ä–∞—Ç–∞ —ñ –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤ –º–∞–≥—ñ—á–Ω–∏–π, —è–∫—â–æ —Ü–µ –º–æ–∂–ª–∏–≤–æ",
      resources_tip: "–ö–æ—Ä–∏—Å–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è",
      how_title: "–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î?",
      how_text: "–í–∏–±–µ—Ä—ñ—Ç—å 2 –∫–ª—é—á—ñ ‚Äî —Ç—Ä—ñ–π–∫–∏ —É–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö —Ü–∏—Ñ—Ä –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–µ–Ω—å. –ü–æ—Ç—ñ–º –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É <i>¬´–ü–æ–±—É–¥—É–≤–∞—Ç–∏¬ª</i>, —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ –∫–≤–∞–¥—Ä–∞—Ç.",
    "label_key1": "–ö–ª—é—á 1:",
    "label_key2": "–ö–ª—é—á 2:",
    "in_combination": "—É –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó"
  },
    en: {
      training: "üß† Training Mode",
      analyze: "üìä Analyze",
      resources: "üîó Resources",
      build: "Build",
      heading: "Magic Squares",
      subheading: "based on Aslan Uarziaty's method",
      training_tip: "Step-by-step learning",
      analyze_tip: "Analyze and convert to magic square if possible",
      resources_tip: "Helpful resources",
      how_title: "How does it work?",
      how_text: "Choose 2 keys ‚Äî sets of unique digits without repeats. Then click <i>‚ÄúBuild‚Äù</i> to see the square.",
    "label_key1": "Key 1:",
    "label_key2": "Key 2:",
    "in_combination": "in combination"
  },
    de: {
      training: "üß† Lernmodus",
      analyze: "üìä Analyse",
      resources: "üîó Ressourcen",
      build: "Erstellen",
      heading: "Magische Quadrate",
      subheading: "nach der Methode von Aslan Uarziaty",
      training_tip: "Schrittweises Lernen",
      analyze_tip: "Analyse des aktuellen Quadrats und Umwandlung in ein magisches Quadrat, falls m√∂glich",
      resources_tip: "N√ºtzliche Ressourcen",
      how_title: "Wie funktioniert das?",
      how_text: "W√§hle 2 Schl√ºssel ‚Äî jeweils drei eindeutige Ziffern. Klicke dann auf <i>‚ÄûErstellen‚Äú</i>, um das Quadrat zu sehen.",
    "label_key1": "Schl√ºssel 1:",
    "label_key2": "Schl√ºssel 2:",
    "in_combination": "in Kombination"
  }
  };

  function updateTranslations(lang) {
    console.log("[i18n] üîÅ Updating translations for language:", lang);
    document.querySelectorAll("[data-i18n]").forEach(el => {
      const key = el.getAttribute("data-i18n");
      const tag = el.tagName.toLowerCase();
      if (translations[lang] && translations[lang][key]) {
        const translated = translations[lang][key];
        if (tag === 'p' || tag === 'div' || el.hasAttribute("data-html") || tag === 'strong' || tag === 'span' || tag === 'h1' || tag === 'h2') {
          el.innerHTML = translated;
        } else {
          el.textContent = translated;
        }
        console.log(`[i18n] ‚úÖ [${tag}] Updated: [${key}] => "${translated}"`);
      } else {
        console.warn(`[i18n] ‚ö†Ô∏è [${tag}] Missing translation for: [${key}] in [${lang}]`);
      }
    });
    document.querySelectorAll("[data-tooltip-key]").forEach(el => {
      const key = el.getAttribute("data-tooltip-key");
      if (translations[lang] && translations[lang][key]) {
        el.setAttribute("data-tooltip", translations[lang][key]);
        console.log(`[tooltip] ‚úÖ Updated: [${key}] => "${translations[lang][key]}"`);
      } else {
        console.warn(`[tooltip] ‚ö†Ô∏è Missing tooltip for: [${key}] in [${lang}]`);
      }
    });
  }

  document.addEventListener("DOMContentLoaded", () => {
    console.log("[i18n] ‚úÖ DOMContentLoaded triggered");
    const selector = document.getElementById("language-select");
    if (!selector) {
      console.error("[i18n] ‚ùå language-select element not found!");
      return;
    }
    console.log("[i18n] üåç Found language-select:", selector.value);
    updateTranslations(selector.value);
    selector.addEventListener("change", () => {
      console.log("[i18n] üåê Language changed to:", selector.value);
      updateTranslations(selector.value);
    });
  });
})();
</script>
<!-- DEBUG BLOCK -->
<script>
(function() {
  const observer = new MutationObserver(() => {
    const keys = Array.from(document.querySelectorAll("[data-i18n]")).map(el => el.getAttribute("data-i18n"));
    if (keys.includes("how_title") && keys.includes("how_text")) {
      console.log("[i18n] üïµÔ∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã how_title –∏ how_text –≤ DOM ‚Äî –∑–∞–ø—É—Å–∫–∞–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥");
      updateTranslations(document.getElementById("language-select").value);
      observer.disconnect();
    }
  });

  observer.observe(document.body, { childList: true, subtree: true });
})();
</script>

<script>
function updateVisibleLanguageText() {
  let lang = localStorage.getItem("lang") || "ru";
  if (lang === "ua") lang = "uk";
  document.querySelectorAll('.lang-ru, .lang-uk, .lang-en, .lang-de').forEach(el => {
    el.classList.remove("lang-visible");
  });
  document.querySelectorAll(`.lang-${lang}`).forEach(el => {
    el.classList.add("lang-visible");
  });
}
document.addEventListener("DOMContentLoaded", () => {
  setTimeout(updateVisibleLanguageText, 0);
  const langSelect = document.getElementById("language-select");
  if (langSelect) {
    langSelect.addEventListener("change", () => {
      let value = langSelect.value;
      if (value === "ua") value = "uk";
      localStorage.setItem("lang", value);
      document.querySelectorAll(".step-card").forEach(card => card.remove());
    });
  }
});
</script>




<script>
  const langSelect = document.getElementById("language-select");
  if (langSelect) {
    langSelect.addEventListener("change", function () {
      const selectedLang = this.value;
      localStorage.setItem("lang", selectedLang); // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —è–∑—ã–∫–∞
      updateVisibleLanguageText();

      // –û—á–∏—Å—Ç–∫–∞ –∞–Ω–∞–ª–∏–∑–∞
      const analysis = document.getElementById("analysis-output");
      if (analysis) analysis.innerHTML = "";
    });
  }
</script>

</body>
</html>
